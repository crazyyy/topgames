function AutosizeMod(e,i){function t(t){return function(l){var h=intval(getStyle(e,"width"));1>h&&(h=browser.msie?document.body.clientWidth-65:intval(getStyle(e,"width",!1))),o.padding&&(h-=2*o.padding),setStyle(n,{width:h});var p=e.value;if(a=getSize(e,!0)[1],t&&(13!=l.keyCode||l.ctrlKey||l.altKey||(p+="\n")),p!=d||!t){d=p,n.innerHTML=trim(replaceChars(p)).replace(/<br>$/,"<br>&nbsp;");var c=getSize(n,!0)[1]+4;s>c&&(c=s),r>0&&c>r?(c=r,setStyle(e,{overflow:"auto",overflowX:"hidden"})):setStyle(e,{overflowX:"hidden"}),a!=c&&(setStyle(e,{height:a=c}),i.onResize&&i.onResize(c))}}}if(null==e)return!1;var o={height:0,minHeight:0,padding:0};i=extend(o,i);var n,d,a,l=ge("autosize_helpers");l||(l=document.createElement("div"),l.id="autosize_helpers",setStyle(l,{position:"absolute",left:-1e4,top:-1e4}),document.body.appendChild(l)),n=document.createElement("div"),l.appendChild(n),n.style.wordWrap="break-word";var s=intval(i.minHeight)||intval(getStyle(e,"height")),r=intval(i.height),h=intval(getStyle(e,"fontSize"));e.style.overflow="hidden";var p=intval(getStyle(e,"width"));return 1>p&&(p=browser.msie?document.body.clientWidth-65:intval(getStyle(e,"width",!1))),o.padding&&(p-=2*o.padding),setStyle(n,{width:0>p?0:p,fontFamily:getStyle(e,"fontFamily"),fontSize:h+"px",lineHeight:getStyle(e,"lineHeight")}),addEvent(e,"keydown",t(!0)),addEvent(e,"keypress",t(!0)),addEvent(e,"keyup",t(!1)),{update:t(!1)}}function setupPollShare(){placeholderSetup(ge("pollShareText")),new AutosizeMod(ge("pollShareText"),{minHeight:28}),createButton(ge("pollShare"),sharePollVote)}function savePollVote(optionId){if(!isVisible("loading")){if(noAuthVal)return widgetAuth();show("loading"),Ajax.postWithCaptcha("/widget_poll.php",{act:"a_vote",option_id:optionId,hash:voteHash,app:_aid,poll_id:_pollId},{onSuccess:function(obj,text){var res=eval("("+text+")");mainDiv.innerHTML=res.html,res.js&&eval(res.js),resizeWidget()},onFail:function(){hide("loading")},onCaptchaHide:function(){hide("loading")}})}}function resetPollVote(optionId,anchor){isVisible("loading")||(hide("revoteLink"),show("loading"),Ajax.postWithCaptcha("/widget_poll.php",{act:"a_unvote",option_id:optionId,hash:voteHash,app:_aid,poll_id:_pollId},{onSuccess:function(obj,text){var res=eval("("+text+")");mainDiv.innerHTML=res.html,res.js&&eval(res.js),resizeWidget()},onFail:function(){hide("loading")},onCaptchaHide:function(){hide("loading")}}))}function showStats(){isVisible("loading")||(hide("revoteLink"),show("loading"),Ajax.postWithCaptcha("/widget_poll.php",{act:"a_stats",app:_aid,poll_id:_pollId},{onSuccess:function(obj,text){var res=eval("("+text+")");mainDiv.innerHTML=res.html,res.js&&eval(res.js),resizeWidget()},onFail:function(){hide("loading")},onCaptchaHide:function(){hide("loading")}}))}function sharePollVote(){isVisible("loading")||(hide("revoteLink"),show("loading"),Ajax.postWithCaptcha("/widget_poll.php",{act:"a_share",message:ge("pollShareText").getValue?ge("pollShareText").getValue():ge("pollShareText").value,hash:voteHash,url:pollUrl,app:_aid,poll_id:_pollId},{onSuccess:function(e,i){hide("loading"),show("revoteLink"),ge("pollFooter").innerHTML=i,resizeWidget()},onFail:function(){hide("loading"),show("revoteLink")},onCaptchaHide:function(){hide("loading"),show("revoteLink")}}))}function resizeWidget(){if(window.mainDiv&&window.Rpc){var e=getSize(window.mainDiv)[1];(browser.msie||browser.opera)&&(e+=15),window.mentions_mod&&150>e&&window.mention&&mention.select.isVisible()&&(e+=Math.max(getSize(mention.select.list)[1]-35,0)),window.Rpc.callMethod("resize",e)}}function goAway(e){return!0}function widgetAuth(){function e(){l.closed?window.gotSession(!0):setTimeout(e,1e3)}if(window.insideVK)try{window.parent.AlertBox("error","Authorization works only on another domain.")}catch(i){}else{var t="undefined"!=typeof window.screenX?window.screenX:window.screenLeft,o="undefined"!=typeof window.screenY?window.screenY:window.screenTop,n="undefined"!=typeof window.outerWidth?window.outerWidth:document.body.clientWidth,d="undefined"!=typeof window.outerHeight?window.outerHeight:document.body.clientHeight-22,a="width=655,height=479,left="+parseInt(t+(n-655)/2,10)+",top="+parseInt(o+(d-479)/2.5,10),l=this.active=window.open(location.protocol+"//oauth.vk.com/authorize?client_id=-1&redirect_uri=close.html&display=widget","vk_openapi",a);e()}}function gotSession(e){location.reload()}insideVK=-1!=location.href.indexOf("&inside_vk=1"),onDomReady(function(){setInterval(resizeWidget,1e3),window.mainDiv=ge("pollMain"),window.Rpc=new fastXDM.Client({onInit:resizeWidget},{safe:!0})});