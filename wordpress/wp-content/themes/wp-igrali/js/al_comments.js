function initCustomMedia(e,t,i){if(e=ge(e),!e)return!1;i=i||{},window.__addMediaIndex||(__addMediaIndex=0);var o=++__addMediaIndex;if(i.bgsprite)var s=i.bgsprite;else if(window.devicePixelRatio>=2){var s="/images/icons/attach_icons_2x.png?6";i.bgSize="20px 220px"}else var s="/images/icons/attach_icons.png?6";vkImage().src=s;var a='<div class="rows"><div class="add_media_head"><nobr>'+e.innerHTML+"</nobr></div></div>";window.customMenuNode||(window.customMenuNode=domFC(domFC(pageNode.appendChild(ce("div",{id:"",innerHTML:'<div class="scroll_fix" id="custom_menu_wrap" style="width:'+(lastInnerWidth-1)+'px"><div id="custom_menu_cont"></div></div>'})))));var r=ce("div",{id:"add_media_menu_"+o,className:"add_media_menu",innerHTML:'<div class="add_media_rows">'+a+"</div>"},{position:"absolute"}),l=geByClass1("rows",r,"div");customMenuNode.appendChild(r);var n,d={id:o,fixed:-1,menuNode:r,updateFixed:function(t){if(!(-1!=d.fixed&&-1!=t&&void 0!==t&&d.fixed==t||-1!=d.fixed&&void 0===t)){if(void 0===t||-1==t){var i=e;for(d.fixed=!1;i;){if("fixed"==getStyle(i,"position")){d.fixed=!0;break}i=i.offsetParent}}else d.fixed=t;d.fixed?(setStyle(customMenuNode,{position:""}),addClass(customMenuNode,"fixed")):(setStyle(customMenuNode,{position:"absolute"}),removeClass(customMenuNode,"fixed")),isVisible(r)&&d._updatePosition(!0)}},show:function(){if(clearTimeout(n),r&&!isVisible(r)){e.blur(),d.updateFixed(-1);var t=d._updatePosition(),o=r.firstChild;browser.msie&&browser.version<9||browser.mobile?show(r):(setStyle(o,{height:26,overflow:"hidden"}),fadeIn(r,200),d.reverse&&(setStyle(o,{position:"absolute",bottom:"-25px",width:getSize(o.firstChild)[0]}),setStyle(o.firstChild,{position:"absolute",bottom:"0px"})),animate(o,{height:t-2},200,function(){setStyle(o.firstChild,{position:"relative",bottom:""}),setStyle(o,{height:"",overflow:"",position:"static"})})),i.onShow&&i.onShow()}},_updatePosition:function(t){var i=getXY(e,d.fixed),o=i[1]-4+(browser.msie&&browser.version<8?1:0),s=r.firstChild,a=geByClass1("add_media_more",r);if(vk.rtl){var n=lastInnerWidth-1-(i[0]+getSize(e)[0]+8);setStyle(r,{right:n,top:o})}else{var c=i[0]-8+(browser.msie6?1:0);setStyle(r,{left:c,top:o})}t||(setStyle(r,{visibility:"hidden",display:"block"}),a&&(hide(a),show(a.nextSibling)));var p=getSize(s),h=d.fixed?0:scrollGetY(),u=p;t||(a&&(show(a),hide(a.nextSibling),u=getSize(s)),setStyle(r,{visibility:"",display:"none"}));var _=!1;if(p[1]-25<o-h&&lastWindowHeight+h<o+p[1]?(setStyle(s,"marginTop",-u[1]+25),d.reverse||(_=!0)):(setStyle(s,"marginTop",-4),d.reverse&&(_=!0)),_){for(var m=l.childNodes,v=m.length,w=(d.moreWrap||{}).lastChild||{};v--;)l.appendChild(m[v]);for(m=w.childNodes,v=(m||[]).length;v--;)w.appendChild(m[v]);d.reverse=!d.reverse,(d.reverse?addClass:removeClass)(r,"add_media_rev")}return u[1]},hide:function(e){clearTimeout(n);var t=browser.msie&&browser.version<9||browser.mobile?hide.pbind(r):fadeOut.pbind(r,100);e===!0?t():n=setTimeout(t,300),i.onHide&&i.onHide()},setItems:function(e){for(var t=l.firstChild,a=l.lastChild;t!=a;t=l.firstChild,a=l.lastChild)l.removeChild("add_media_head"==t.className?a:t);var n=/mac/.test(_ua)&&browser.mozilla?{height:19,paddingTop:3}:{},c=!1,p=e.length>6&&getLang("global_add_media_more");d.moreWrap=!1,each(e,function(e,t){var a,h={innerHTML:"<nobr>"+t[1].replace(/\s/g,"&nbsp;")+"</nobr>",className:"add_media_type_"+o+"_"+t[0]+" add_media_item"},u=t[6]||{backgroundImage:"url("+(t[5]||s)+")",backgroundPosition:t[2]||"0 0"};if(i.bgSize&&(u.backgroundSize=i.bgSize),p&&3==e){var _=r.firstChild,m=l.appendChild(ce("div",{className:"add_media_more_wrap"}));addEvent(m,"mouseover click",function(){if(clearTimeout(d.moreHide),!isVisible(m.lastChild)&&(show(m.lastChild),hide(m.firstChild),d.reverse)){var e=getSize(_);setStyle(_,"marginTop",-e[1]+25)}}),addEvent(m,"mouseout",function(){clearTimeout(d.moreHide),d.moreHide=setTimeout(function(){if(hide(m.lastChild),show(m.firstChild),d.reverse){var e=getSize(_);setStyle(_,"marginTop",-e[1]+25)}},300)}),a=m.appendChild(ce("a",{className:"add_media_more add_media_item",innerHTML:"<nobr>"+getLang("global_add_media_more")+"</nobr>"})),c=ce("div",{className:"add_media_more_node",innerHTML:'<div class="unshown"></div>'},{display:"none"}),a=m.appendChild(c),d.moreWrap=m}extend(u,n),t[4]&&(h.href=t[4]),a=(c?c:l).appendChild(ce("a",h,u)),t[3]&&addEvent(a,"click",function(){return d.hide(!0),t[3](),!1})})}};return t&&d.setItems(t),removeEvent(e,"mouseover"),addEvent(e,"mouseover click",d.show),addEvent(e,"mouseout",d.hide),addEvent(r,"mouseover",d.show),addEvent(r,"mouseout",d.hide),addEvent(r,"click",cancelEvent),addEvent(geByClass1("add_media_header",r),"click",function(e){d.show(!0),cancelEvent(e)}),cur.destroy.push(function(){cleanElems(r),re(r),removeEvent(e,"click",d.show)}),d}function initAddMedia(e,t,i,o){var s,a=[],r={graffiti:-151,video:-19,photo:3,audio:-41};o=o||{},each(i||[],function(e,t){if(t[1]){var i=!1,s=o.toId||cur.postTo,l=({to_id:s,scrollbar_width:sbWidth()},{height:window.outerHeight||screen.availHeight||768,width:window.outerWidth||screen.availWidth||1028});switch(t[0]){case"graffiti":i=function(){cur.Rpc.callMethod("showBox","al_wall.php?"+ajx2q({act:"canvas_draw_box",to_id:cur.postTo,widget:1}),l)};break;case"photo":i=function(){stManager.add(["page.css"],function(){cur.Rpc.callMethod("showBox","al_photos.php?"+ajx2q({act:"choose_photo",to_id:cur.postTo,scrollbar_width:window.sbWidth(),preview:1,widget:1,widget_width:590}),l)})};break;case"video":i=function(){cur.Rpc.callMethod("showBox","al_video.php?"+ajx2q({act:"a_choose_video_box",to_id:cur.postTo,scrollbar_width:window.sbWidth(),preview:1,widget:1}),l)};break;case"audio":i=function(){stManager.add(["page.css"],function(){cur.Rpc.callMethod("showBox","al_audio.php?"+ajx2q({act:"a_choose_audio_box",to_id:cur.postTo,scrollbar_width:window.sbWidth(),preview:1,widget:1,addCss:"profile.css"}),l)})};break;default:topError("Unknown type: "+t[0])}{var n=!1,d="3px "+r[t[0]]+"px",c=!1;t[1].replace(/\s/g,"&nbsp;")}a.push([t[0],t[1],d,i,c,n])}});var l=initCustomMedia(e,a,{onShow:function(){cur.chooseMedia=s.chooseMedia,cur.showMediaProgress=s.showMediaProgress}});if(l){t=t||"media_preview";var n,d=l.id,c=ge(t),p=o.limit||10,h=p>1,u=!browser.msie||browser.version>8,_=!browser.msie||browser.version>8;val(c,'<div id="page_pics_preview'+d+'" class="page_pics_preview media_preview clear_fix"></div><div id="page_dpics_preview'+d+'" class="page_pics_preview page_media_sortable media_preview clear_fix"></div><div id="page_docs_preview'+d+'" class="page_docs_preview page_media_sortable media_preview clear_fix"></div><div id="page_pdocs_preview'+d+'" class="page_docs_preview media_preview clear_fix"></div><div id="page_ldocs_preview'+d+'" class="page_docs_preview media_preview clear_fix"></div><div id="page_mpics_preview'+d+'" class="page_pics_preview media_preview clear_fix"></div><div id="page_ppdocs_preview'+d+'" class="page_docs_preview media_preview clear_fix"></div><div id="page_progress_preview'+d+'" class="page_progress_preview media_preview clear_fix"></div>');var m=domFC(c),v=domNS(m),w=domNS(v),g=domNS(w),f=domNS(g),b=domNS(f),y=domNS(b),n=domNS(y);return removeClass(c,"media_preview"),addClass(c,"multi_media_preview"),s={_addMediaLink:e,lnkId:d,menu:l,handlers:{},chosenMedias:[],_showAddMedia:function(){l.show()},_hideAddMedia:function(e){l.hide(e)},chooseMedia:function(t,i,a,r,n,y){if(s.onChange&&s.onChange(t,i,a,r)===!1)return!1;if(inArray(t,o.disabledTypes||[]))return!1;if(s.attachCount()>=p&&void 0===a.upload_ind&&"postpone"!==t){if(h)return!1;s.unchooseMedia()}var k=!1,C={};if(h&&(each(s.chosenMedias,function(){return this[0]==t&&this[1]==i?(k=!0,!1):void(C[this[0]]=C[this[0]]?C[this[0]]+1:1)}),k))return!1;var x,S="",M="",T=!1,W=w,P="";switch(t){case"graffiti":isObject(a)||(a={thumb:a||""}),S='<div class="fl_l page_preview_graffiti"><img class="page_preview_graffiti" src="'+clean(a.thumb)+'" /></div>',W=T=b;break;case"photo":if(isObject(a)||(a={thumb_m:a[0]||"",thumb_s:a[1]||"",list:a[2]||"",view_opts:a[3]||"",upload_ind:a.upload_ind||void 0}),vkImage().src=a.thumb_m,u){if(!a.editable)return!1;o.nocl||fastXDM.getJSON(function(e){a.editable.click=showPhoto.pbind(i,a.list,e.parse(a.view_opts.replace(/&quot;/g,'"')))})}var N=a.view_opts.replace(/"/g,"&quot;").replace(/^{|}$/g,"");N&&(N+=","),N+="queue:1",x=o.nocl?"":" onclick=\"return showPhoto('"+i+"', '"+a.list+"', {"+N+'});"',S="<div "+x+' class="fl_l page_preview_photo'+(y?" page_preview_ph_graff":"")+'"><img class="page_preview_photo" src="'+a.thumb_m+'" /></div>',T=1,W=m;break;case"video":if(isObject(a)||(a={thumb:a||""}),u){if(!a.editable)return!1;o.nocl||(a.editable.click=showVideo.pbind(i))}x=o.nocl?"":" onclick=\"return showVideo('"+clean(i)+"', false, {queue:1});\"",S="<div"+x+' class="fl_l page_preview_video"><img class="page_preview_video" src="'+clean(a.thumb)+'" /></div>',T=1,W=m;break;case"audio":if(!a.info)return!1;S=WComments.addAudioPreview(i,a),P=' id="pam'+clean(d)+"_audio"+clean(i)+'"';break;case"share":if(C.share||C.page||!a.lang)return!1;isArray(a)&&(a={domain:a[0],url:a[1],initialPattern:a[2],title:a[3],description:a[4],images:[a[5]],user_id:a[6],photo_id:a[7]}),S='<a target="_blank" href="/away.php?to='+encodeURIComponent(a.url)+'" class="medadd_h medadd_h_link inl_bl">'+clean(a.lang.profile_choose_link)+"</a>",s.shareData=extend(s.shareData||{},a,{imagesStyles:[""]}),W=f;break;case"poll":if(!a.lang)return!1;S='<div class="medadd_h medadd_h_poll inl_bl">'+clean(a.lang.q)+"</div>",hide(geByClass1("add_media_type_"+d+"_poll",l.menuNode,"a")),W=g;break;case"album":if(u){if(!a.editable)return!1;extend(a.editable,{title:a.title,size:a.count,click:o.nocl?!1:nav.change.pbind({z:"album"+i})})}vkImage().src=a.thumb,x=o.nocl?"":' href="/album'+clean(i)+'" onclick="return nav.change({z: \'album'+clean(i)+"'}, event)\"";var E="fl_l page_preview_album wall_album_cover_wrap"+(a.thumb?"":" wall_album_nocover");S='<a class="'+E+'" '+x+">"+(a.thumb?'<img class="wall_album_cover" src="'+clean(a.thumb)+'"/>':"")+'  <div class="wall_album_caption">    <div class="wall_album_title_wrap clear_fix">      <div class="wall_album_title fl_l">'+clean(a.title)+'</div>      <div class="wall_album_count fl_r">'+clean(a.count)+"</div>    </div>  </div></a>",T=1,W=m}if(h){var H=s.chosenMedias,L=H.length,D=u&&1===T?!1:se("photos_list"==t?'<div class="page_preview_'+t+'_wrap" style="position: relative">'+S+'<div class="page_photos_count">'+i.split(",").length+"</div></div>":'<div class="page_preview_'+t+'_wrap"'+(o.nocl?' style="cursor: default"':"")+P+">"+S+'<div nosorthandle="1" class="page_media_x_wrap inl_bl" '+(browser.msie&&browser.version<9?"title":"tootltip")+'="'+getLang("dont_attach")+'" onmouseover="if (browser.msie && browser.version < 9) return; showTooltip(this, {text: this.getAttribute(\'tootltip\'), shift: [14, 3, 3], black: 1})" onclick="cur.addMedia['+s.lnkId+"].unchooseMedia("+L+'); return cancelEvent(event);"><div class="page_media_x" nosorthandle="1"></div></div>'+M+"</div>");addClass(D,T?"fl_l":"clear_fix"),void 0!==a.upload_ind&&re("upload"+a.upload_ind+"_progress_wrap"),o.toggleLnk&&toggle(e,s.attachCount()+1<p),u&&1===T?(addClass(W,"editable_thumbs_wrap"),W=domLC(W)&&hasClass(domLC(W),"editable_thumbs")?domLC(W):W.appendChild(ce("div",{id:"thumbs_edit"+d,className:"editable_thumbs"})),stManager.add(["thumbs_edit.css","thumbs_edit.js"],function(){o.toggleLnk&&toggle(e,s.attachCount()+1<p),a.editable.remove=s.unchooseMedia.pbind(L),show(domPN(W));var r=ThumbsEdit.convert(t,i,a.editable);domFC(W)?ThumbsEdit.addMedia(W,r):o.teWidth&&o.teHeight?ThumbsEdit.init(W,[r],{width:o.teWidth,height:o.teHeight}):ThumbsEdit.init(W,[r])},!0)):(show(W),W.appendChild(D),_&&(W==w?stManager.add(["sorter.js"],function(){w.sorter?sorter.added(w):W.childNodes.length>1&&sorter.init(w,{})},!0):W==v&&stManager.add(["qsorter.js"],function(){v.qsorter?qsorter.added(v):W.childNodes.length>1&&qsorter.init(v,s.qsorterOpts())},!0))),H.push([t,i,D,r])}else val(c,'<div class="fl_l">'+S+'</div><div class="x fl_l" onmouseover="showTooltip(this, {text: \''+getLang("dont_attach")+'\', shift: [0, 3, 3]})" onclick="cur.addMedia['+d+'].unchooseMedia()"></div>'),show(c),s.chosenMedia=[t,i],s.chosenMediaData=a;"share"==t?a.title&&!r?(cur.shareShowImg=0,s.showPreview(!0),s.shareData.images=!1):s.showExternalPreview():"page"==t?a.nopreview||(cur.shareShowImg=0,s.shareData=extend(s.shareData||{},a,{images:!1}),s.showPreview()):"poll"==t?s.createPoll(a):"postpone"==t&&s.setupPostpone(a,exp);var j=window.event;return j&&"click"==j.type&&(event.ctrlKey||event.metaKey||event.shiftKey)&&(n=!0),cur.fileApiUploadStarted||cur.preventBoxHide||n===!0||inArray(t,["poll","share","page","postpone"])||boxQueue.hideLast(),cur.lastPostMsg=!1,o.onMediaAdd&&o.onMediaAdd(),void 0!==a.upload_ind&&delete a.upload_ind,!1},unchooseMedia:function(t){if(s.onChange&&s.onChange(!1,t)===!1)return!1;if(h){if(void 0===t)return window.ThumbsEdit&&ThumbsEdit.removeAll("thumbs_edit"+d),each(s.chosenMedias,function(e,t){t&&void 0!==e&&s.unchooseMedia(e)}),void(s.urlsCancelled=[]);var i,a=s.chosenMedias;if(a[t]){switch(a[t][2]?((i=geByClass1("page_media_x_wrap",a[t][2],"div"))&&i.tt&&i.tt.el&&i.tt.destroy(),domPN(a[t][2])==w&&w.sorter?(each(w.sorter.elems,function(){setStyle(this,{top:"auto",left:"auto",cursor:"auto"})}),w.sorter.destroy(),re(a[t][2]),w.childNodes.length>1&&sorter.init(w,{})):domPN(a[t][2])==v&&v.qsorter?(each(v.qsorter.elems,function(){setStyle(domFC(this),{top:"auto",left:"auto"}),setStyle(this,{cursor:"auto"})}),v.qsorter.destroy(),re(a[t][2]),v.childNodes.length>1&&qsorter.init(v,s.qsorterOpts())):re(a[t][2])):("photo"==a[t][0]||"video"==a[t][0]||"album"==a[t][0])&&window.ThumbsEdit&&ThumbsEdit.removeById("thumbs_edit"+d,a[t][0]+a[t][1]),a[t][0]){case"page":case"share":s.shareData={},re(s.sharePreview),delete s.sharePreview;break;case"poll":re(s.pollPreview),s.pollPreview=!1,show(geByClass1("add_media_type_"+d+"_poll",l.menuNode,"a"));break;case"app":each(geByClass("add_media_type_"+d+"_app",l.menuNode,"a"),function(){show(this)});break;case"map":show(geByClass1("add_media_type_"+d+"_map",ge("add_media_menu_"+d)));break;case"postpone":var r=geByClass1("medadd_c_timersett",s.postponePreview);re(cur.editingPost&&r?domFC(s.postponePreview):s.postponePreview),s.postponePreview=!1,removeClass("official","disabled"),cur.editingPost?geByTag1("button",geByClass1("button_blue",ge("post"+cur.editingPost[0]))).innerHTML=getLang("wall_publish_now"):ge("send_post").innerHTML=getLang("wall_send"),show(geByClass1("add_media_type_"+d+"_postpone",l.menuNode,"a"))}a[t]=!1}o.toggleLnk&&toggle(e,s.attachCount()<p),toggle(m,!!(u?geByClass1("thumb_wrap",m):domFC(m))),toggle(v,!!domFC(v)),toggle(w,!!domFC(w)),toggle(g,!!domFC(g)),toggle(f,!!domFC(f)),toggle(b,!!domFC(b)),toggle(y,!!domFC(y)),toggle(n,!!domFC(n))}else{var _,i;s.chosenMedia&&((i=c.firstChild.nextSibling)&&i.tt&&i.tt.el&&i.tt.destroy(),s.chosenMedia=!1,s.chosenMediaData=!1,val(c,""),hide(c)),(_=s.shareData)&&(_.url&&s.urlsCancelled.push(_.url),_.initialPattern&&s.urlsCancelled.push(_.initialPattern),s.shareData={}),each([s.sharePreview,s.pollPreview,s.postponePreview],function(){re(this)}),s.sharePreview=s.pollPreview=s.postponePreview=!1}cur.lastPostMsg=!1,s.onChange&&s.onChange(!1)},getMedias:function(){var e=window.ThumbsEdit?ThumbsEdit.getMedias("thumbs_edit"+d):[],t={},i=s.chosenMedias||[],o=[],a=function(e,i,s){return s[0]+s[1]==e?(o.push(s),t[e]=!0,!1):void 0};return each(e,function(e,t){each(i,a.pbind(t[0]+t[1]))}),each(v.childNodes,function(e,t){var o=(t.id||"").match(/^pam\d+_([a-z]+)(-?\d+_\d+)/);o&&each(i,a.pbind(o[1]+o[2]))}),each(w.childNodes,function(e,t){var o=(t.id||"").match(/^pam\d+_([a-z]+)(-?\d+_\d+)/);o&&each(i,a.pbind(o[1]+o[2]))}),each(i,function(e,i){i&&isArray(i)&&i.length&&!t[i[0]+i[1]]&&o.push(i)}),o},showMediaProgress:function(t,i,a,r){if(s.onProgress&&s.onProgress(t,i,a)===!1)return!1;var l=a.loaded/a.total,u=intval(100*l),_=a.fileName||a.name||"",m=_?i+"_"+_:i,v=_?_.length>33?_.substr(0,30)+"...":_:"",w=ge("upload"+m+"_progress");if(w)if(show(w),w.full){var g=data(w,"tween"),f=intval(w.full*l);g&&g.isTweening?g.to.width=f:animate(w,{width:f+"px"},500)}else setStyle(w,{width:u+"%"});else{cur.attachMediaIndexes||(cur.attachMediaIndexes={}),cur.attachMediaIndexes[m]=d;var b='<div class="fl_l"><div class="page_attach_progress_wrap" style="margin-top: 3px; margin-bottom: 4px;">  <div id="upload'+m+'_progress" class="page_attach_progress"></div></div></div></div>'+(v?'<div class="attach_label fl_l">'+v+"</div>":"")+'<div class="progress_x fl_l" onmouseover="animate(this, {opacity: 1}, 200); showTooltip(this, {text: \''+getLang("dont_attach")+'\', shift: [6, 3, 3]})" onmouseout="animate(this, {opacity: 0.6}, 200);" onclick="cur[\'terminate_upload_'+i+"']('"+(_||i)+"');\"></div>";h?(n.appendChild(ce("div",{id:"upload"+m+"_progress_wrap",innerHTML:b,className:"clear_fix upload_"+i+"_progress"},{marginTop:"6px"})),show(n),o.toggleLnk&&toggle(e,s.attachCount()<p)):(val(c,b),s.chosenMedia="progress"),w=ge("upload"+m+"_progress"),w.full=!1,cur["terminate_upload_"+i]=function(){re("upload"+m+"_progress_wrap"),r()},u?setStyle(w,{width:w.full?intval(w.full*l)+"px":u+"%"}):(setStyle(w,{width:"1px"}),hide(w))}},attachCount:function(){if(s.attachedCount)return s.attachedCount();if(!c)return 0;if(!h)return c.childNodes.length;var e=(u&&window.ThumbsEdit?(ThumbsEdit.cache()["thumbs_edit"+d]||{}).previews||[]:m.childNodes).length+v.childNodes.length+b.childNodes.length+w.childNodes.length/(w.sorter?2:1)+n.childNodes.length;return s.sharePreview&&++e,s.pollPreview&&++e,e},createPoll:function(e){{var t,i=browser.msie6||e.question?"":"1px",o=[];e[22]?"disabled":"",e[8]?"":"disabled"}s.pollPreview=g.appendChild(ce("div",{className:"medadd_c medadd_c_poll",innerHTML:'<input onkeydown="cur.addMedia['+d+'].keyPoll(this, event)" class="text medadd_c_pollq" id="create_poll_question'+d+'" value="'+(e.question||"")+'" /><div class="medadd_c_pollh">'+e.lang.a+'</div><div class="medadd_c_pollans" id="create_poll_answers'+d+'"></div><div class="medadd_c_polladd_wr" id="create_poll_add'+d+'">  <div class="medadd_c_polladd" onclick="cur.addMedia['+d+'].incPoll()">'+e.lang.i+"</div></div>"+(e.edit?"":'<div class="checkbox medadd_c_pollcb'+(e.anon?" on":"")+'" id="create_poll_anonymous'+d+'" onclick="checkbox(this)"><div></div>'+e.lang.c+"</div>")})),e.answers||(e.answers=[[0,""],[0,""]]),cur.pollAnswerTemplate='<input onkeydown="cur.addMedia[%lnkid%].keyPoll(this, event)" class="text medadd_c_polla" %attrs%/><div class="page_media_x_wrap medadd_c_pollrem inl_bl" '+(browser.msie?"title":"tootltip")+'="'+e.lang.d+'" onmouseover="if (browser.msie) return; showTooltip(this, {text: this.getAttribute(\'tootltip\'), shift: [14, 3, 3], black: 1})" onclick="cur.addMedia[%lnkid%].decPoll(this)"><div class="page_media_x"></div></div>';for(var a=0,r=e.answers.length;r>a;++a)t=e.answers[a],o.push('<div class="medadd_c_polla_wr">'+rs(cur.pollAnswerTemplate,{attrs:t[0]?'id="create_poll_ans'+t[0]+'" value="'+t[1]+'" ':"",lnkid:d})+"</div>"),9==a&&hide("create_poll_add"+d);return val("create_poll_answers"+d,o.join("")),browser.msie6||e.question?void elfocus("create_poll_question"+d):(s.pollPreview.style.height=i,void animate(s.pollPreview,{height:166},200,function(){s.pollPreview.style.height="auto",elfocus("create_poll_question"+d)}))},incPoll:function(){var e=ge("create_poll_answers"+d),t=e.childNodes.length;10>t&&elfocus(geByTag1("input",e.appendChild(ce("div",{className:"medadd_c_polla_wr",innerHTML:rs(cur.pollAnswerTemplate,{attrs:"",lnkid:d})})))),toggle("create_poll_add"+d,9>t)},decPoll:function(e){e.tt&&e.tt.el&&e.tt.destroy(),re(domPN(e)),show("create_poll_add"+d)},keyPoll:function(e,t){if(t=t||window.event,t&&(10==t.keyCode||13==t.keyCode||9==t.keyCode)){var i=hasClass(e,"medadd_c_pollq")?domFC(domNS(domNS(e))):domNS(domPN(e));return i?elfocus(geByTag1("input",i)):this.incPoll(),cancelEvent(t)}},pollData:function(){for(var e,t=ge("create_poll_answers"+d),i=trim(val("create_poll_question"+d)),o={media:i,anonymous:isChecked("create_poll_anonymous"+d)},s=0,a=!1,r=domFC(t);r;r=domNS(r))if(e=trim(val(domFC(r)))){var l=-intval((domFC(r).id.match(/^create_poll_ans(\d+)$/)||[0,-s++])[1]);o["answers["+l+"]"]=e,a=!0}return i?a?o:(domFC(t)||cur.addMedia[d].incPoll(),notaBene(domFC(domFC(t))),!1):(notaBene("create_poll_question"+d),!1)},urlsCancelled:[],shareData:{},checkMessageURLs:function(e,t){if(!(s.chosenMedia||s.urlAttachmentLoading&&s.urlAttachmentLoading[0]>vkNow()-1e4||s.attachCount()>=p))for(var i,o=t?urlInactiveExp:urlActiveExp;e&&(i=e.match(o));){e=e.substr(i.index+i[0].length);var a=i[2],r=i[5]||"",l=a;if(a.match(/^https?:\/\//)||(a="http://"+a),!((i[6]||"").length>1||inArray(a,s.urlsCancelled)||inArray(l,s.urlsCancelled))){var n=!0;if(i[4].match(/(^|\.|\/\/)vkontakte\.ru|vk\.com/)&&(n=r.match(/(#photo|^\/(photo|video|album|page|audio|doc)|z=(album|photo|video)|w=(page))(-?\d+_)?\d+|\.(jpg|png|gif)$/)?!0:!1),n)return void s.checkURL(l)}}},onCheckURLDone:function(e,t){var i="";s.urlAttachmentLoading&&(re(s.urlAttachmentLoading[2]),toggle(n,n.childNodes>0),i=s.urlAttachmentLoading[1],s.urlAttachmentLoading=!1,setStyle(bodyNode,{cursor:"default"})),e&&s.chooseMedia(t[0],t[1],t[2],i,!0)},checkURL:function(e){if(e){s.urlsCancelled.push(e),s.urlAttachmentLoading=[vkNow(),e],re(s.checkURLForm),s.checkURLForm=ce("div",{innerHTML:'<iframe name="share_parse_iframe'+d+'"></iframe>'}),utilsNode.appendChild(s.checkURLForm);var t=s.checkURLForm.appendChild(ce("form",{action:"share.php?act=url_attachment",method:"post",target:"share_parse_iframe"+d}));each({hash:cur.share_timehash||cur.options.share.timehash||"",index:d,url:e},function(e,i){t.appendChild(ce("input",{type:"hidden",name:e,value:i}))}),setStyle(bodyNode,{cursor:"wait"}),window.onUploadDone=s.onCheckURLDone.pbind(!0),window.onUploadFail=s.onCheckURLDone.pbind(!1),t.submit()}},addPreview:function(e){return s.sharePreview=f.appendChild(ce("div",{className:"medadd_c medadd_c_link",innerHTML:'<div class="medadd_c_linkcon"><div></div>'+(e?'<div class="progress medadd_c_linkprg"></div>':"")+"</div>"}))},showPreview:function(e){var i=s.shareData,o=s.sharePreview||s.addPreview();if(i.failed)var a=getLang("page_not_loaded");else var r=e?"":'onload="if (this.width < 130) cur.shareShowNext();"',a=(i.images&&i.images[cur.shareShowImg]?'<img class="medadd_c_linkimg fl_l" src="'+clean(i.images[cur.shareShowImg])+'" '+r+(i.imagesStyles&&i.imagesStyles[cur.shareShowImg]||"")+" />":"")+(i.title?'<h4 class="medadd_c_linkhead">'+i.title+"</h4>":"")+(i.description?'<div class="medadd_c_linkdsc">'+i.description+"</div>":"")+'<div class="clear"></div>';if(e)val(domFC(o),a),domFC(o).style.height="auto";else{{!isVisible(f)}show(f);var l=ge(t).appendChild(ce("div",{innerHTML:'<div class="medadd_c_linkcon">'+a+"</div>"},{position:"absolute",width:getSize(o)[0]-10,visibility:"hidden"})),n=getSize(l)[1]-12;re(l),animate(domFC(o),{height:n},200,function(){val(domFC(o),a)})}},showExternalPreview:function(){var e=s.shareData;if(!e.images||!e.images.length)return cur.shareShowImg=0,void s.showPreview();cur.shareShowImg=-1,s.addPreview(!0),e.imagesStyles={};var t=!1;cur.shareShowNext=function(){var i=vkImage();if(cur.shareShowImg+=1,cur.shareShowImg>e.images.length-1)cur.shareShowImg=0;else if(0==cur.shareShowImg)for(var o=1;o<e.images.length-1;o++){var a=vkImage();a.src=e.images[o]}if(!e.images.length||isEmpty(e.images)||void 0===e.images[cur.shareShowImg])return s.showPreview(t),void(t=!0);i.src=e.images[cur.shareShowImg];var r=setTimeout(function(){cur.shareImgInterval!==!0&&(e.images.splice(cur.shareShowImg,1),cur.shareShowNext())},5e3),l=function(){if(i.width||i.height){var o=i.width,a=i.height,l="",n="";if(r&&clearTimeout(r),clearInterval(cur.shareImgInterval),20>o||20>a){if(e.images.splice(cur.shareShowImg,1),e.images.length)return setTimeout(cur.shareShowNext,0)}else o>a&&o>150?(a=150*a/o,o=150):a>150&&(o=150*o/a,a=150),l="width: "+o+"px; height: "+a+"px;";e.images.length>1&&(l+="cursor: pointer",n=' onclick="cur.shareShowNext();"'),e.imagesStyles[cur.shareShowImg]='style="'+l+'"'+n,s.showPreview(t),t=!0}};clearInterval(cur.shareImgInterval),cur.shareImgInterval=setInterval(l,300),setTimeout(l,0)},cur.shareShowNext()},uploadShare:function(e){var t=s.shareData,i=s.sharePreview,o=i.appendChild(ce("div",{innerHTML:'<iframe class="upload_frame" name="share_upload_iframe'+d+'"></iframe>'})),a=o.appendChild(ce("form",{action:"/share.php",method:"post",target:"share_upload_iframe"+d})),r=t.images[cur.shareShowImg];each({act:"a_photo",url:t.url,index:d,image:r,extra:t.extra||0,hash:vk.ip_h},function(e,t){a.appendChild(ce("input",{type:"hidden",name:e,value:t}))}),window.onUploadDone=function(t,a){window.onUploadFail=window.onUploadDone=function(){},i.removeChild(o),s.shareData=extend(s.shareData,{user_id:a.user_id,photo_id:a.photo_id,photo_url:r,images:[]}),setTimeout(e,0)},window.onUploadFail=function(t,a){window.onUploadFail=window.onUploadDone=function(){},i.removeChild(o),s.shareData.images=[],setTimeout(e,0)},cur.shareLastParseSubmitted=vkNow(),a.submit()},setupPostpone:function(e,t){var i=cur.editingPost&&"wpe_media_preview"==domPN(y).id,o=browser.msie6||i?"":"1px",a=!1,r='<div class="clear_fix"><div class="fl_l"><input type="hidden" id="postpone_date'+d+'" value="'+(e.date||"")+'" /></div><div class="fl_l medadd_c_timerat">'+e.lang.profile_wall_postpone_at+'</div><div class="fl_l"><input type="hidden" id="postpone_time'+d+'"/></div></div>';cur.editingPost&&void 0!=e.friends_only?(r+='<div class="medadd_c_timersett">',void 0!=e.status_export&&(r+='<div class="checkbox_status_export'+(e.status_export?" on":"")+' fl_l" id="status_export'+d+'" onclick="checkbox(this)" onmouseover="showTooltip(this, {text: \''+e.lang.export_to_twitter+"', black: 1, shift: [12,4,0]});\"><div></div></div>"),void 0!=e.facebook_export&&(r+='<div class="checkbox_facebook_export'+(e.facebook_export?" on":"")+' fl_l" id="facebook_export'+d+'" onclick="checkbox(this)" onmouseover="showTooltip(this, {text: \''+e.lang.export_to_facebook+"', black: 1, shift: [12,4,0]});\"><div></div></div>"),r+='<div class="checkbox'+(e.friends_only?" on":"")+' fl_l" id="friends_only'+d+'" onclick="checkbox(this);checkbox(\'status_export'+d+"',!isChecked(this));checkbox('facebook_export"+d+"',!isChecked(this));\"><div></div>"+e.lang.friends_only+"</div></div>",a=!0):cur.editingPost&&t&&(r+=t,a=!0),s.postponePreview=y.appendChild(ce("div",{className:"medadd_c medadd_c_timer clear_fix"+(a?" medadd_c_nofixed":""),innerHTML:r})),s.postponePreview.style.height=o,stManager.add(["ui_controls.css","ui_controls.js","datepicker.css","datepicker.js"],function(){new Datepicker("postpone_date"+d,{time:"postpone_time"+d,width:120,noPast:!0}),browser.msie6||i||animate(s.postponePreview,{height:33},200,function(){s.postponePreview.style.height=""})})},destroy:function(){w.sorter&&w.sorter.destroy(),v.qsorter&&v.qsorter.destroy()},qsorterOpts:function(){return{xsize:Math.floor(v.offsetWidth/110),width:110,height:83,clsUp:"pam_dpic_up"}},resized:function(){window.ThumbsEdit&&ThumbsEdit.setWide("thumbs_edit"+cur.wallEditComposer.addMedia.lnkId),v.qsorter&&(v.qsorter.destroy(),qsorter.init(v,s.qsorterOpts()))}},cur.addMedia||(cur.addMedia={}),cur.addMedia[d]=s,s}}function goAway(e){return!0}function gotSession(e){location.reload()}function showPhoto(e,t){return cur.Rpc.callMethod("showBox","al_photos.php?"+ajx2q({act:"photo_box",photo:e,wall_owner:e.split("_")[0],widget:1,list:t,widget_width:654,widget:1}),{height:window.outerHeight||screen.availHeight||768,width:window.outerWidth||screen.availWidth||1028}),!1}function showVideo(e,t){return revertLastInlineVideo(),cur.Rpc.callMethod("showBox","al_video.php?"+ajx2q({act:"video_box",video:e,list:t,wall_owner:e.split("_")[0],widget_width:654,widget:1}),{height:window.outerHeight||screen.availHeight||768,width:window.outerWidth||screen.availWidth||1028}),!1}function showCaptchaBox(e,t,i,o){var s=intval(t)?"":"&s=1",a=o.imgSrc||"/captcha.php?sid="+e+s;cur.Rpc.callMethod("showBox","al_apps.php?"+ajx2q({act:"show_captcha_box",sid:e,src:a,need_mobile:1==window.need_mobile_act?1:0,widget:1,widget_width:322}),{height:window.outerHeight||screen.availHeight||768,width:window.outerWidth||screen.availWidth||1028}),cur.RpcMethods.captcha=o.onSubmit,cur.RpcMethods.captchaHide=o.onHide}function Scrollbar(e,t){this.obj=e=ge(e),this.options=t||{},this.clPref=t.prefix||"",this.isHorizontal=t.horizontal,this.scrollProp=this.isHorizontal?"scrollLeft":"scrollTop",this.scrollDimensionProp=this.isHorizontal?"scrollHeight":"scrollWidth",setTimeout(function(){function i(e){return r.moveY||checkEvent(e)?void 0:(addEvent(window.document,"mousemove",r.mouseMove),addEvent(window.document,"mouseup",r.mouseUp),r.isHorizontal?r.moveX=e.pageX-(r.inner.offsetLeft||0):r.moveY=e.pageY-(r.inner.offsetTop||0),window.document.body.style.cursor="pointer",addClass(r.inner,r.clPref+"scrollbar_hovered"),t.startDrag&&t.startDrag(),t.onHold&&t.onHold(!0),r.isDown=!0,cancelEvent(e))}function o(e){switch((e||window.event).keyCode){case 40:r.obj[r.scrollProp]+=40;break;case 38:r.obj[r.scrollProp]-=40;break;case 34:r.obj[r.scrollProp]+=r[r.scrollDimensionProp];break;case 33:r.obj[r.scrollProp]-=r[r.scrollDimensionProp];break;default:return!0}return r.update(!0),cancelEvent(e)}setStyle(e,{overflow:"hidden"});var s,a=getSize(e);s=this.isHorizontal?{marginTop:a[1]+2+"px",width:a[0]+"px"}:{marginLeft:a[0]-(t.mlDiff||7)+"px",height:a[1]+"px"},t.nomargin&&(delete s.marginLeft,s.right=t.right||0,s.left=t.left||0),this.scrollWidth=a[0],this.scrollHeight=a[1],this.scrollbar=ce("div",{className:this.clPref+"scrollbar_cont"}),setStyle(this.scrollbar,s),this.inner=ce("div",{className:this.clPref+"scrollbar_inner"}),this.scrollbar.appendChild(this.inner),t.shadows&&(e.parentNode.insertBefore(this.topShadowDiv=ce("div",{className:this.clPref+"scrollbar_top"},{width:a[0]}),e),e.parentNode.insertBefore(this.bottomShadowDiv=ce("div",{className:this.clPref+"scrollbar_bottom"},{width:a[0]}),e.nextSibling)),e.parentNode.insertBefore(this.scrollbar,e),this.destroyList=[],this.mouseMove=this._mouseMove.bind(this),this.mouseUp=this._mouseUp.bind(this);var r=this;this.mouseDown=i;var l=this.wheel.bind(this);if(addEvent(e,"mousewheel",l),addEvent(e,"DOMMouseScroll",l),t.scrollElements)for(var n in t.scrollElements)addEvent(t.scrollElements[n],"mousewheel",l),addEvent(t.scrollElements[n],"DOMMouseScroll",l);if(addEvent(this.scrollbar,"mousewheel",l),addEvent(this.scrollbar,"DOMMouseScroll",l),addEvent(this.scrollbar,"mouseover",this.contOver.bind(this)),addEvent(this.scrollbar,"mouseout",this.contOut.bind(this)),addEvent(this.scrollbar,"mousedown",this.contDown.bind(this)),browser.safari_mobile){var d=function(e){r.isHorizontal?cur.touchX=e.touches[0].pageX:cur.touchY=e.touches[0].pageY},c=function(t){if(!r.isHorizontal){var i=t.touches[0].pageY;return cur.touchDiff=cur.touchY-i,e.scrollTop+=cur.touchDiff,cur.touchY=i,e.scrollTop>0&&r.shown!==!1&&r.update(!0),cancelEvent(t)}var o=t.touches[0].pageX;cur.touchDiff=cur.touchX-o,e.scrollLeft+=cur.touchDiff,cur.touchX=o,e.scrollLeft>0&&r.shown!==!1&&r.update(!0)},p=function(){cur.animateInt=setInterval(function(){cur.touchDiff=.9*cur.touchDiff,cur.touchDiff<1&&cur.touchDiff>-1?clearInterval(cur.animateInt):(e[r.scrollProp]+=cur.touchDiff,r.update(!0))},0)};addEvent(e,"touchstart",d),addEvent(e,"touchmove",c),addEvent(e,"touchend",p),this.destroyList.push(function(){removeEvent(e,"touchstart",d),removeEvent(e,"touchmove",c),removeEvent(e,"touchend",p)})}addEvent(this.inner,"mousedown",i),t.nokeys?this.onkeydown=o:addEvent(window,"keydown",o),this.destroyList.push(function(){if(removeEvent(e,"mousewheel",l),removeEvent(e,"DOMMouseScroll",l),t.scrollElements)for(var s in t.scrollElements)removeEvent(t.scrollElements[s],"mousewheel",l),removeEvent(t.scrollElements[s],"DOMMouseScroll",l);

removeEvent(r.inner,"mousedown",i),removeEvent(window,"keydown",o)}),this.isHorizontal||(this.contHeight()<=this.scrollHeight?hide(this.bottomShadowDiv):this.bottomShadow=!0),this.inited=!0,this.update(!0),t.global||cur.destroy.push(this.destroy.bind(this))}.bind(this),0)}function showInlineVideo(videoId,listId,options,ev,thumb){if(checkEvent(ev))return!0;if(window.mvcur&&mvcur.mvShown)return showVideo(videoId,listId,options,ev);options=options||{},options.params=options.params||{act:"show_inline",video:videoId,list:listId,autoplay:options.autoplay?1:0,module:options.module||cur.module||"_ac"};var h=thumb.clientHeight,w=thumb.clientWidth,btn=geByClass1("video_play_inline",thumb,"div");return!trim(options.params.module)&&window.nav&&extend(options.params,{_nol:JSON.stringify(nav.objLoc)}),extend(options.params,{width:w,height:h}),options.onDone=function(title,html,js,opts){revertLastInlineVideo(),hide(thumb);var videoWrap=ce("div",{id:"page_video_inline_wrap"+videoId,className:"page_video_inline_wrap",innerHTML:html},{width:w,height:h}),videoBg=ge("video_background"+videoId);_videoLastInlined=[videoWrap,thumb],thumb.parentNode.appendChild(videoWrap),videoBg&&setStyle(geByTag1("img",videoBg),{width:w,height:h});try{eval("(function () {"+js+"})();")}catch(e){debugLog("video inline error",e.message,e.stack,e,js)}var _n=window.Notifier,_a=window.audioPlayer;_n&&setTimeout(function(){_n.lcSend("video_start")},0),_a&&_a.player&&!_a.player.paused()&&(_a.pauseTrack(),_a.pausedByVideo=1)},options.showProgress=function(){addClass(btn,"video_play_inline_loading")},options.hideProgress=function(){removeClass(btn,"video_play_inline_loading")},ajax.post("al_video.php",options.params,options),!1}function revertLastInlineVideo(){window._videoLastInlined&&(re(_videoLastInlined[0]),show(_videoLastInlined[1]),_videoLastInlined=!1)}function showWiki(e){return e=e.w.split("/"),"likes"!=e[0]?!1:void WComments.showLikesBox(e[1])}function showBox(e,t,i,o){var s={};return s["like.php"]="publish_box",s[e]&&t.act==s[e]?(t.widget=cur.widgetHash,void cur.Rpc.callMethod("showBox",e+"?"+ajx2q(t),{height:window.outerHeight||screen.availHeight||768,width:window.outerWidth||screen.availWidth||1028})):oldShowBox(e,t,i,o)}WComments={getSectionParams:function(){var e={app:cur.options.app,limit:cur.options.limit};switch(cur.section){case"admin_browse":e.act="admin_browse";break;case"admin_bl":e.act="admin_bl";break;case"admin_updates":e.act="admin_updates";break;case"browse":e.browse=1,e.replies=cur.options.replies;break;default:e.page_query=cur.options.page_query,e.part=1}return e},showMore:function(){if(cur.options.offset>=cur.options.count)return void hide("wcomments_more_link");if(!cur.moreLoading){cur.moreLoading=!0;var e=extend(WComments.getSectionParams(),{offset:cur.options.offset,part:1});ajax.post("al_widget_comments.php",e,{onDone:function(e,t){ge("wcomments_posts").appendChild(cf(t)),WComments.resizeWidget(),WComments.applyOptions(e),cur.scrollbar&&cur.scrollbar.update(!1,!0),cur.moreLoading=!1},showProgress:function(){hide("wcomments_more"),show("wcomments_more_progress"),cur.moreLoading=!0},hideProgress:function(){hide("wcomments_more_progress"),show("wcomments_more"),cur.moreLoading=!1}})}},switchSection:function(e){var t=!e.indexOf("admin"),i=ge("wcomments_tab_"+cur.section),o=ge("wcomments_tab_"+e),s=ge("wcomments_admin_link");toggle("wcomments_admin_nav",t),toggle("wcomments_form",!t),i&&(i.className="wcomments_tab"),cur.section=e,o&&(o.className="wcomments_tab_selected"),removeEvent(s,"click"),s.removeAttribute("onclick"),t?(s.innerHTML=getLang("widgets_comments_moder_return"),s.onclick=function(){return WComments.switchSection("page"),!1}):(s.innerHTML=getLang("widgets_comments_moder_browse"),s.onclick=function(){return WComments.switchSection("admin_browse"),!1}),ge("wcomments_posts").innerHTML='<div class="wcomments_posts_loading"></div>',hide("wcomments_more_link");var a=extend(WComments.getSectionParams(),{});ajax.post("al_widget_comments.php",a,{onDone:function(e,t){ge("wcomments_posts").innerHTML=t,cur.scrollbar&&cur.scrollbar.update(!1,!0),WComments.applyOptions(e)}})},refresh:function(){var e=extend(WComments.getSectionParams(),{part:1});ajax.post("al_widget_comments.php",e,{onDone:function(e,t){ge("wcomments_posts").innerHTML=t,WComments.applyOptions(e),WComments.resizeWidget()},showProgress:function(){ge("wcomments_posts").innerHTML='<div class="wcomments_posts_loading"></div>',hide("wcomments_more_link"),WComments.resizeWidget()},hideProgress:function(){}})},applyOptions:function(options){options.reply_names&&(cur.options.reply_names=extend(cur.options.reply_names||{},options.reply_names),delete options.reply_names),options.head_count&&"browse"!=cur.section&&(ge("wcomments_count").innerHTML=options.head_count,delete options.head_count),options.script&&(eval(options.script),delete options.script),extend(cur.options,options),toggle("wcomments_more_link",options.offset<options.count)},addToBl:function(e,t,i){ajax.post("al_widget_comments.php",{act:"a_add_to_bl",id:e,hash:t,app:cur.options.app},{onDone:function(o){hide("wcomments_bl_label"+e),i.onclick=function(){return WComments.delFromBl(e,t,i),!1},i.innerHTML=getLang("widgets_remove_from_banlist")},showProgress:function(){hide(i),show("wcomments_progress"+e)},hideProgress:function(){show(i),hide("wcomments_progress"+e)}})},delFromBl:function(e,t,i){ajax.post("al_widget_comments.php",{act:"a_del_from_bl",id:e,hash:t,app:cur.options.app},{onDone:function(o){setStyle("wcomments_bl_label"+e,"display","inline"),i.onclick=function(){return WComments.addToBl(e,t,i),!1},i.innerHTML=getLang("widgets_restore_to_banlist")},showProgress:function(){hide(i),show("wcomments_progress"+e)},hideProgress:function(){show(i),hide("wcomments_progress"+e)}})},deleteAllAndBan:function(e,t,i,o){ajax.post("al_widget_comments.php",{act:"a_add_to_bl",id:t,hash:i,app:cur.options.app},{onDone:function(i){each(geByClass("wcomments_post",ge("wcomments_posts"),"div"),function(){this.id.indexOf("post"+t)||this.id=="post"+e||hide(this)}),ge("post_del"+e).innerHTML=i},showProgress:function(){lockButton(o)},hideProgress:function(){unlockButton(o)}})},showLikesBox:function(e){cur.Rpc.callMethod("showBox","widget_like.php?"+ajx2q({act:"a_stats_box",obj:e,from:"wcomments",app:cur.options.app,widget_width:620}),{height:window.outerHeight||screen.availHeight||768,width:window.outerWidth||screen.availWidth||1028})},resizeWidget:function(){if(cur.heightEl&&cur.Rpc){var e=getSize(cur.heightEl)[1];(browser.msie&&!browser.msie8||browser.opera)&&(e+=15),window.onBodyResize&&onBodyResize(),cur.Rpc.callMethod("resize",e)}},auth:function(){function e(){r.closed?window.gotSession(!0):setTimeout(e,1e3)}var t="undefined"!=typeof window.screenX?window.screenX:window.screenLeft,i="undefined"!=typeof window.screenY?window.screenY:window.screenTop,o="undefined"!=typeof window.outerWidth?window.outerWidth:document.body.clientWidth,s="undefined"!=typeof window.outerHeight?window.outerHeight:document.body.clientHeight-22,a="width=655,height=479,left="+parseInt(t+(o-655)/2,10)+",top="+parseInt(i+(s-479)/2.5,10),r=this.active=window.open(location.protocol+"//oauth.vk.com/authorize?client_id=-1&redirect_uri=close.html&display=widget","vk_openapi",a);e()},initQTransport:function(e){window.curNotifier=extend(e,{lp_connected:!1,error_timeout:1}),WComments.lpInit(),WComments.lpStart()},lpGetTransportWrap:function(){var e=ge("queue_transport_wrap");return e||(e=ce("div",{id:"queue_transport_wrap"}),utilsNode.appendChild(e)),e},lpInit:function(){curNotifier.lpMakeRequest||(delete curNotifier.lpMakeRequest,re("queue_transport_frame"),WComments.lpGetTransportWrap().appendChild(ce("iframe",{id:"queue_transport_frame",name:"queue_transport_frame",src:curNotifier.frame_path})))},lpStart:function(){curNotifier.lp_started=!0,WComments.lpCheck()},lpStop:function(){curNotifier.lp_started=!1,clearTimeout(curNotifier.lp_check_to),clearTimeout(curNotifier.lp_error_to)},lpCheck:function(){return curNotifier.lp_started?curNotifier.lpMakeRequest?void curNotifier.lpMakeRequest(curNotifier.frame_url,{act:"a_check",ts:curNotifier.timestamp,key:curNotifier.key,id:curNotifier.uid,wait:25},function(text){if(curNotifier.lp_started)try{var success=this.lpChecked(eval("("+text+")"));success&&(this.lpCheck(),curNotifier.error_timeout=1)}catch(e){topError("Notify error: "+e.message),curNotifier.lp_error_to=setTimeout(this.lpCheck.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2)}}.bind(this),function(e){curNotifier.lp_error_to=setTimeout(this.lpCheck.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2)}.bind(this)):void(curNotifier.lp_check_to=setTimeout(this.lpCheck.bind(this),1e3)):void 0},lpChecked:function(e){var t=e.failed;if(2==t)return curNotifier.lp_error_to=setTimeout(this.lpGetKey.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2),!1;if(t)throw getLang("global_unknown_error");if(curNotifier.timestamp=e.ts,!cur.section.indexOf("admin"))return!0;if(cur.options.fixed_height)var i=ge("wcomments_posts_wrap"),o=ge("wcomments_posts"),s=i.scrollTop,a=o.offsetHeight;return each(e.events,function(e,t){WComments.pushEvent(t)}),cur.options.fixed_height&&(i.scrollTop=s>100?s+(o.offsetHeight-a):0,cur.scrollbar&&cur.scrollbar.update(!1,!0)),!0},lpGetKey:function(){vkNow();ajax.post("al_widget_comments.php",{act:"a_get_key",id:curNotifier.uid,app:cur.options.app,page_query:cur.options.page_query},{onDone:function(e,t){curNotifier.timestamp=t,curNotifier.key=e,this.lpCheck()}.bind(this),onFail:function(e){return 3==e?void location.reload():(curNotifier.error_timeout=64,this.lp_error_to=setTimeout(this.lpGetKey.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2),!0)}.bind(this)})},pushEvent:function(e){var t=e.split("<!>"),i=t[0],o=t[1],s=t[2],a=ge("post"+s);if(i!=cur.options.qversion)return void location.reload();switch(o){case"new_post":if(a)break;var r=ge("wcomments_posts"),l=ce("div",{innerHTML:Wall.getNewPostHTML(t,cur.options.is_admin)}).firstChild,n=intval(t[8]),d=geByClass("wcomments_post",r,"div"),c=d&&d.length&&d[d.length-1];r.insertBefore(l,r.firstChild),setStyle(l,{backgroundColor:"#FEFAE4"}),animate(l,{backgroundColor:"#FFF"},6e3),"browse"!=cur.section&&val("wcomments_count",n>0?getLang("widgets_comments_top_count",n):getLang("widgets_comments")),c&&c.parentNode.removeChild(c);break;case"del_post":a&&(!cur.wallMyDeleted[s]&&hide(a),cur.options.offset--);break;case"res_post":a&&cur.options.offset++;break;case"new_reply":if(!a||cur.wallMyReplied[s]||ge("post"+t[3]))break;var p=ge("replies"+s),l=ce("div",{innerHTML:Wall.getNewReplyHTML(t,cur.options.is_admin)}).firstChild,h=!1;if(isVisible("reply_link"+s))re("reply_link"+s),show("replies_wrap"+s),h=!0;else{var u=p.nextSibling,n=geByClass("new_reply",p,"div").length+1;if(cur.wallMyOpened[s]){u&&"replies_open"==u.className&&re(u),h=!0;var _=geByClass1("wr_header",p,"a"),m=geByClass("reply",p,"div").length+1,v=m;_&&(v=intval(_.getAttribute("offs").split("/")[1])+1),(v>5||v>m)&&(_||p.insertBefore(_=ce("a",{className:"wr_header"}),p.firstChild),Wall.updateRepliesHeader(s,_,m,v))}else addClass(l,"new_reply"),u&&"replies_open"==u.className||(u=ce("div",{className:"replies_open",onclick:Wall.openNewComments.pbind(s)}),p.parentNode.insertBefore(u,p.nextSibling)),u.innerHTML=getLang("news_x_new_replies_more",Math.min(100,n)),u.newCnt=n}p.appendChild(l),h&&(setStyle(l,{backgroundColor:"#FEFAE4"}),animate(l,{backgroundColor:"#FFF"},6e3));break;case"del_reply":!cur.wallMyDeleted[s]&&re(a)}},updateMini:function(){cur.options.mini="auto"==cur.options.mini?cur.heightEl.clientWidth<630:1==intval(cur.options.mini),toggleClass("wcomments_posts","wide_wall_module",!cur.options.mini),toggleClass(bodyNode,"font_medium",!cur.options.mini)},init:function(e){cur.options=e,extend(cur,{oid:e.user_id,postTo:e.user_id,heightEl:ge("wcomments_page"),fullPostView:1,fullPostHeight:56,noNavGo:!0,section:"posts",noAwayCheck:!0}),cur.section=e.browse?"browse":"posts",Wall.init(e),WComments.updateMini(),e.fixed_height&&(browser.msie6?setStyle("wcomments_posts_wrap",{height:e.fixed_height-127}):setStyle("wcomments_posts_wrap",{maxHeight:e.fixed_height-127}),cur.scrollbar=new Scrollbar("wcomments_posts_wrap",{more:WComments.showMore,startDrag:function(){try{cur.Rpc.callMethod("startDrag")}catch(e){}},stopDrag:function(){try{cur.Rpc.callMethod("stopDrag")}catch(e){}},mlDiff:16}),cur.mouseMove=function(e){cur.scrollbar.mouseMove(e)},cur.mouseUp=function(){cur.scrollbar.mouseUp()}),e.qtransport&&WComments.initQTransport(e.qtransport),timeUpdateInt=setInterval(function(){WComments.updateTimes()},1e4),cur.RpcMethods={onInit:function(){setTimeout(function(){WComments.resizeWidget()},0),setTimeout(function(){WComments.resizeWidget()},500)},mouseMove:function(e){cur.mouseMove(intval(e))},mouseUp:function(){cur.mouseUp()},chooseMedia:function(){var e=[],t=Array.prototype.slice.apply(arguments);for(var i in t)e.push(cleanObj(t[i]));cur.chooseMedia.apply(cur.chooseMedia,e)},showMediaProgress:function(){var e=[cleanObj(arguments[0]),cleanObj(arguments[1]),cleanObj(arguments[2]),arguments[3]];cur.showMediaProgress.apply(cur.showMediaProgress,e)},likeFullUpdate:function(){}};try{cur.Rpc=new fastXDM.Client(cur.RpcMethods,{safe:!0}),cur.resizeInt=setInterval(WComments.resizeWidget,1e3)}catch(t){debugLog(t)}e.user_id||(addEvent("send_post","click",WComments.auth),addEvent("post_field","click focus",WComments.auth))},langWordNumeric:function(e,t,i){return e<t.length?t[e]:langNumeric(e,i)},updateTimes:function(){var e=intval(vkNow()/1e3),t=[];each(geByClass("rel_date_needs_update",ge("wcomments_posts"),"span"),function(i,o){if(o){var s=intval(o.getAttribute("time")),a=e-s,r=o.getAttribute("abs_time");5>a?r=getLang("news_just_now"):60>a?r=WComments.langWordNumeric(a,cur.lang.news_X_seconds_ago_words,cur.lang.news_X_seconds_ago):3600>a?r=WComments.langWordNumeric(intval(a/60),cur.lang.news_X_minutes_ago_words,cur.lang.news_X_minutes_ago):14400>a?r=WComments.langWordNumeric(intval(a/3600),cur.lang.news_X_hours_ago_words,cur.lang.news_X_hours_ago):t.push(o),o.innerHTML=r}}),each(t,function(){removeClass(this,"rel_date_needs_update")})},addAudioPreview:function(e,t){stManager.add(["audioplayer.css"]);var i=Math.floor(1e9*(1+Math.random())),o=e+"_"+i,s=t.info;return'<div class="medadd_aud inl_bl" id="audio'+o+'"><table cellspacing="0" cellpadding="0" width="100%"><tr>  <td rowspan="2"><div class="medadd_aud_playwrap" onclick="playAudioNew(\''+o+'\') + data">    <div class="medadd_aud_play" id="play'+o+'"></div>    <input type="hidden" id="audio_info'+o+'" value="'+s+'"/>  </div></td>  <td class="info medadd_aud_td medadd_aud_wid"><div class="title_wrap fl_l" onmouseover="setTitle(this)">    <b class="medadd_aud_perf">'+t.performer+'</b> &ndash; <span class="title" id="title'+o+'">'+t.title+' </span>  </div><div class="duration fl_r" onmousedown="if (window.audioPlayer) audioPlayer.switchTimeFormat(\''+o+"', event)\">"+t.duration+'</div></td></tr><tr>  <td class="medadd_aud_td"><div class="audio_back_line medadd_aud_ph"></div><div id="player'+o+'" class="player" ondragstart="return false;" onselectstart="return false;">    <table cellspacing="0" cellpadding="0" border="0" width="100%"><tr>      <td class="medadd_aud_td medadd_aud_wid">        <div id="audio_pr'+o+"\" class=\"audio_pr\" onmouseover=\"addClass(this, 'over'); if (cur.hideTipTO) clearTimeout(cur.hideTipTO);\" onmouseout=\"removeClass(this, 'over'); removeClass(this, 'down'); cur.hideTipTO = setTimeout(hide.pbind('audio_tip_wrap'), 100);\" onmousedown=\"addClass(this, 'down'); audioPlayer.prClick(event);\" onmouseup=\"removeClass(this, 'down')\">          <div id=\"audio_white_line"+o+'" class="audio_white_line" onmousedown="audioPlayer.prClick(event);"></div>          <div id="audio_back_line'+o+'" class="audio_back_line" onmousedown="audioPlayer.prClick(event);"><!-- --></div>          <div id="audio_load_line'+o+'" class="audio_load_line" onmousedown="audioPlayer.prClick(event);"><!-- --></div>          <div id="audio_pr_line'+o+'" class="audio_progress_line" onmousedown="audioPlayer.prClick(event);">            <div id="audio_pr_slider'+o+'" class="audio_slider"><!-- --></div>          </div>        </div>      </td><td class="medadd_aud_td">        <div id="audio_vol'+o+'" class="audio_vol" onmouseover="addClass(this, \'over\')" onmouseout="removeClass(this, \'over\'); removeClass(this, \'down\')" onmousedown="addClass(this, \'down\'); audioPlayer.volClick(event)" onmouseup="removeClass(this, \'down\')">          <div id="audio_vol_white_line'+o+'" class="audio_vol_white_line" onmousedown="audioPlayer.volClick(event);"><!-- --></div>          <div id="audio_vol_back_line'+o+'" class="audio_load_line" onmousedown="audioPlayer.volClick(event);"><!-- --></div>          <div id="audio_vol_line'+o+'" class="audio_progress_line" onmousedown="audioPlayer.volClick(event);">            <div id="audio_vol_slider'+o+'" class="audio_slider" onmousedown="audioPlayer.volClick(event);"><!-- --></div>          </div>        </div>      </td>    </tr></table>  </div></td></tr></table></div>'}};var Wall={checkTextLen:function(e,t,i){},checkPostLen:function(e,t){},showEditPost:function(){return cur.viewAsBox?(setTimeout(function(){ge("post_field").blur()},0),cur.viewAsBox()):void(0!==cur.editing&&(cur.withMentions&&!cur.mentionsAdded?(cur.mentionsAdded=!0,stManager.add(["ui_controls.css","ui_controls.js","mentions.js"],function(){initMentionClass(),cur.postMention=new MentionAutocomplete("post_field",{minHeight:cur.fullPostView?cur.fullPostHeight||50:32,introText:getLang("profile_mention_start_typing"),noResult:getLang("profile_mention_not_found"),onSubmit:Wall.sendPost,checkLen:Wall.checkPostLen,onValueChange:(cur.wallAddMedia||{}).checkMessageURLs}),addEvent(cur.postMention.rtaEl,"focus",Wall.showEditPost),ge("post_field").focused!==!1&&triggerEvent(ge("post_field"),"focus")})):cur.postMention&&(cur.postMention.options.minHeight=cur.fullPostView?cur.fullPostHeight||50:32),Wall.hideEditPostReply(),show("submit_post"),autosizeSetup("post_field",{minHeight:cur.fullPostView?cur.fullPostHeight||50:32}),cur.editing=0))},hideEditPost:function(e){cur.editing=!1;var t=ge("post_field");browser.opera_mobile||!t||cur.fullPostView||!e&&t.getValue&&trim(t.getValue())||(hide("submit_post"),t&&!t.value&&(cur.postMention&&(cur.postMention.options.minHeight=14),setStyle(t,{height:14}),t.phonsize&&t.phonsize()))},sendPost:function(){var e=cur.wallAddMedia||{},t=e.chosenMedia||{},i=e.getMedias?e.getMedias():[],o=e.shareData||{},s=ge("post_field").getValue(),a=0;o.initialPattern&&trim(s)==o.initialPattern&&(s="");var r={act:"post",message:s,to_id:cur.postTo,type:"widget_comments",status_export:"",widget_app:cur.options.app,widget_page_url:cur.options.page_url,widget_page_title:cur.options.page_title,widget_page_desc:cur.options.page_desc,widget_page_query:cur.options.page_query,hash:cur.options.post_hash};if(isArray(t)&&t.length&&i.push(clone(t)),!(i&&i.length||s))return void elfocus("post_field");if(i.length){var l=!1;if(each(i,function(t,i){if(i){var n=this[0],d=this[1];switch(n){case"poll":var c=e.pollData();if(!c)return l=!0,!1;d=c.media,delete c.media,r=extend(r,c);break;case"share":if(!(!o.failed&&o.url&&(o.title||o.images&&o.images.length||o.photo_url)))return cur.shareLastParseSubmitted&&vkNow()-cur.shareLastParseSubmitted<2e3?(l=!0,!1):void 0;if(d=o.user_id+"_"+o.photo_id,o.images&&o.images.length)return e.uploadShare(Wall.sendPost),l=!0,!1;o.initialPattern&&trim(s)==o.initialPattern&&(r.message=""),r=extend(r,{url:o.url,title:replaceEntities(o.title),description:replaceEntities(o.description),extra:o.extra,extra_data:o.extraData,photo_url:replaceEntities(o.photo_url),open_graph_data:(o.openGraph||{}).data,open_graph_hash:(o.openGraph||{}).hash});break;case"page":o.initialPattern&&trim(s)==o.initialPattern&&(r.message="");break;case"postpone":var p=val("postpone_date"+e.lnkId);return r=extend(r,{postpone:p}),cur.postponedLastDate=p,void(postponePost=!0)}this[3]&&trim(s)==this[3]&&(r.message=""),r["attach"+(a+1)+"_type"]=n,r["attach"+(a+1)]=d,a++}}),l)return}ajax.post("al_wall.php",r,{onDone:function(e){if(e){var t={act:"a_post",post:e,hash:cur.options.post_hash,app:cur.options.app,limit:cur.options.limit,"export":isChecked("wcomments_export")};ajax.post("al_widget_comments.php",t,{onDone:function(e,t){"posts"==cur.section&&cur.Rpc&&cur.Rpc.callMethod("publish","widgets.comments.new_comment",e.count,e.last_comment,e.date,e.full_hash,e.pageId),ge("wcomments_posts").innerHTML=t,WComments.applyOptions(e),cur.scrollbar&&cur.scrollbar.update(!1,!0)},showProgress:function(){lockButton(ge("send_post"))},hideProgress:function(){unlockButton(ge("send_post"))}})}var i=ge("post_field");if(cur.withMentions){var o=data(i,"mention");o&&(o.rtaEl.innerHTML="",hide(o.cont),show(i))}i.value="",i.blur(),i.phonblur(),Wall.hideEditPost(!0),cur.wallAddMedia&&cur.wallAddMedia.unchooseMedia(),hide("post_warn")},showProgress:function(){lockButton(ge("send_post"))},hideProgress:function(){unlockButton(ge("send_post"))}})},_repliesLoaded:function(e,t,i,o){var s=ge("replies"+e),a=s.nextSibling;if(t){var r=browser.msie6?pageNode:browser.chrome||browser.safari?bodyNode:htmlNode,l=s.offsetHeight;s.innerHTML=i,r.scrollTop=intval(r.scrollTop)+(s.offsetHeight-l),setTimeout(Wall.highlightReply.pbind("post"+t),0)}else s.innerHTML=i;a&&"replies_open"==a.className&&re(a),extend(cur.options.reply_names,o)},highlightReply:function(e){if(e=ge(e)){var t=animate.pbind(e,{backgroundColor:"#ECEFF3"},200,function(){setTimeout(function(){animate(e,{backgroundColor:"#FFF"},200)},1e3)}),i=getXY(e),o=i[1]-(bodyNode.scrollTop||htmlNode.scrollTop||0);if(0>o){var s=browser.msie6?pageNode:browser.chrome||browser.safari?bodyNode:htmlNode;animate(s,{scrollTop:s.scrollTop+o-50},300,t)}else t()}},showReply:function(e,t){if(cur.viewAsBox)return!1;var i=ge("post"+t);return i?Wall.highlightReply(i):Wall.showReplies(e,!1,t),!1},showReplies:function(e,t,i,o){return checkEvent(o||window.event)?void 0:cur.viewAsBox?cur.viewAsBox():(hide("wrh_text"+e),cur.wallMyOpened[e]=3!=t,ajax.post("al_wall.php",{act:"get_replies",post:e,count:t},{onDone:Wall._repliesLoaded.pbind(e,i),onFail:show.pbind("wrh_text"+e),progress:"wrh_prg"+e}),!1)},emojiShowTT:function(e,t,i){return void 0===Wall.emojiOpts[e]?!1:Emoji.ttShow(Wall.emojiOpts[e],t,i)},emojiHideTT:function(e,t,i){return void 0===Wall.emojiOpts[e]?!1:Emoji.ttHide(Wall.emojiOpts[e],t,i)},showEmojiTT:function(e,t,i){return void 0===Wall.emojiOpts[e]?!1:Emoji.ttClick(Wall.emojiOpts[e],t,!1,!1,i)},emojiOpts:{},initReplyEditable:function(e,t,i){return e.emojiInited?!1:(e.emojiInited=!0,void stManager.add(["emoji.js","notifier.css"],function(){var o=Emoji.init(e,{ttDiff:-42,rPointer:!0,controlsCont:t,shouldFocus:!0,onSend:function(){Wall.sendReply(i)},ctrlSend:function(){return cur.wallTpl.reply_multiline},noStickers:!0,checkEditable:function(){Wall.checkTextLen.pbind(e,"reply_warn"+i)},onStickerSend:function(e){Wall.sendReply(i,!1,e)}});Wall.emojiOpts[i]=o}))},showEditReply:function(e){if(!vk.id)return WComments.auth(),!1;var t=ge("reply_field"+e),i=ge("post"+e),o=ge("reply_fakebox"+e),s=ge("reply_box"+e);return o&&(s=se(rs(cur.wallTpl.reply_form,{post_id:e})),o.parentNode.replaceChild(s,o),t=ge("reply_field"+e)),Wall.initReplyEditable(t,s,e),cur.editing===e?void elfocus(t):(Wall.hideEditPostReply(),addClass(i,"reply_box_open"),setStyle("replies_wrap"+e,{display:""}),Wall.replyFormHintUpdate(e),cur.editing=e,void setTimeout(elfocus.pbind(t),0))},hideEditReply:function(e){cur.editing=!1;var t,i=ge("reply_field"+e),o=ge("post"+e),s=cur.reply_to&&cur.options.reply_names[cur.reply_to[0]],a=trim(val(i));if(i&&(s&&isArray(s)&&(a&&s[1].indexOf(a)||(val(i,""),a="")),!(browser.opera_mobile||browser.safari_mobile||a))){removeClass(o,"reply_box_open"),(t=ge("reply_link"+e))&&hide("replies_wrap"+e),i.blur(),i.phonblur&&i.phonblur(),val("reply_to"+e,""),hide("reply_to_title"+e),cur.reply_to=!1;var r=cur.replySubmitSettings;r&&r.tt&&r.tt.destroy()}},replyTo:function(e,t,i,o){Wall.showEditReply(e),val("reply_to"+e,t),cur.reply_to=[i,t];var s=cur.options.reply_names[i];if(isArray(s)){val("reply_to_title"+e,s[0]);var a=ge("reply_field"+e),r=cur.reply_to&&cur.options.reply_names[cur.reply_to[0]],l=trim(val(a));(!l||r&&isArray(r)&&!r[1].indexOf(l))&&val(a,checkEvent(o)?"":s[1])}else val("reply_to_title"+e,s);return show("reply_to_title"+e),Wall.replyFormHintUpdate(e),!1},replySubmitTooltip:function(e,t){var i=ge("reply_box"+e),o=i&&geByClass1("reply_hint",i,"div"),s=cur.replySubmitSettings;if(o){if(s||(s=cur.replySubmitSettings=ce("div",{className:"reply_multiline_tt_point"})),!t)return void(s&&s.tt&&s.tt.hide&&s.tt.hide());if(s.parentNode==o&&s.tt&&s.tt.show)return void s.tt.show();s.tt&&s.tt.destroy&&s.tt.destroy(),o.insertBefore(s,o.firstChild);var a=cur.wallTpl.reply_multiline?1:0,r=rs(cur.wallTpl.reply_multiline_hint,{enabled:a?"on":"",disabled:a?"":"on"});showTooltip(s,{text:r,className:"reply_multiline_tt rich wall_tt",shift:[3,15,13],forcetodown:1,slide:15,showdt:400,hidedt:400,hasover:1,onCreate:function(){radioBtns.reply_submit={els:Array.prototype.slice.apply(geByClass("radiobtn",ge("reply_submit_hint_opts"))),val:r?1:0}}})}},onReplySubmitChanged:function(e,t){if(cur.wallTpl.reply_multiline=e,t){var i=cur.replySubmitSettings;i&&i.tt&&i.tt.destroy()}else ajax.post("al_wall.php",{act:"a_save_ctrl_submit",value:e,hash:cur.wallTpl.poll_hash}),window.Notifier&&Notifier.lcSend("wall_reply_multiline",{value:e});cur.editing&&Wall.replyFormHintUpdate(cur.editing)},replyFormHintUpdate:function(e){var t=ge("reply_hint"+e),i=cur.wallTpl.reply_multiline,o=ge("submit_reply"+e),s=ge("reply_button"+e),a=ge("reply_to_title"+e);if(t){var r=o.clientWidth-s.clientWidth-a.clientWidth-24;val(geByTag1("span",t),getLang("wall_reply_submit_hint_"+(i?2:1)+(r>300?"_more":""))),setStyle(t,"width",r)}},onReplySubmit:function(e,t){if((t.keyCode==KEY.RETURN||10==t.keyCode)&&(cur.wallTpl.reply_multiline&&(t.ctrlKey||browser.mac&&t.metaKey)||!cur.wallTpl.reply_multiline&&!t.shiftKey&&!(t.ctrlKey||browser.mac&&t.metaKey)))return Wall.sendReply(e),cancelEvent(t);if(t.ctrlKey&&t.keyCode==KEY.RETURN){var i=ge("reply_field"+e),o=val(i);if("number"==typeof i.selectionStart&&"number"==typeof i.selectionEnd){var s=i.selectionStart;i.value=o.slice(0,s)+"\n"+o.slice(i.selectionEnd),i.selectionStart=i.selectionEnd=s+1}else if(document.selection&&document.selection.createRange){i.focus();var a=document.selection.createRange();a.text="\r\n",a.collapse(!1),browser.opera&&(a.moveEnd("character",0),a.moveStart("character",0)),a.select()}return i.autosize.update(),setTimeout(function(){i.autosize.update()},0),!1}},sendReply:function(e,t,i){if(!window.Emoji)return!1;var o,s,a=ge("reply_field"+e),r=Emoji.val(a),l=trim(r);if(!l||isArray(o=cur.reply_to&&cur.options.reply_names[cur.reply_to[0]])&&!o[1].indexOf(l))return void elfocus("reply_field"+e);Emoji.val(a,""),Emoji.focus(a);var n=ge("post_hash"+e)?ge("post_hash"+e).value:cur.options.post_hash;cur.wallMyReplied[e]=1,cur.wallMyOpened[e]=1;var s={act:"post",type:cur.wallType,reply_to:e,reply_to_msg:val("reply_to"+e),start_id:val("start_reply"+e),message:r,from:"widget",hash:n};ajax.post("al_wall.php",s,{onDone:function(t,i,o){cur.wallMyReplied[e]=0,re("reply_link"+e),hide("reply_warn"+e),Wall._repliesLoaded(e,!1,i,o),cur.wallMyReplies[t]={message:r,reply_to:s.reply_to,reply_to_msg:s.reply_to_msg,reply_to_user:s.reply_to_user}},onFail:function(){newEl&&re(newEl),Emoji.val(a,r)},showProgress:lockButton.pbind(ge("reply_button"+e)),hideProgress:unlockButton.pbind(ge("reply_button"+e))});var d=ge("replies"+e),c=-++cur.wallMyRepliesCnt;if(newEl=se(rs(cur.wallTpl.reply_fast,{reply_id:"0_"+c,message:Emoji.emojiToHTML(r,!0).replace(/\n/g,"<br/>"),date:Wall.getNowRelTime()})),d&&!isVisible(d)||ge("reply_link"+e))re("reply_link"+e),show("replies_wrap"+e);else{var p=d.nextSibling;p&&"replies_open"==p.className&&Wall.openNewComments(e);var h=geByClass1("wr_header",d,"a"),u=geByClass("reply",d,"div").length+1,_=u;h&&(_=intval(h.getAttribute("offs").split("/")[1])+1),(_>5||_>u)&&(h||d.insertBefore(h=ce("a",{className:"wr_header"}),d.firstChild),Wall.updateRepliesHeader(e,h,u,_))}d.appendChild(newEl)},postTooltip:function(e,t,i){cur.viewAsBox||showTooltip(e,{url:"al_wall.php",params:extend({act:"post_tt",post:t},i||{}),slide:15,shift:[35,-3,0],ajaxdt:100,showdt:400,forcetodown:1,hidedt:200,className:"rich wall_tt"})},hideEditPostReply:function(e){if(cur.editing!==!1){var t=e&&e.target?e.target:{},i=t.id;cur.editing?(!e||!hasClass(t,"reply_link")&&i!="reply_field"+cur.editing&&"reply_to_link"!=t.className)&&Wall.hideEditReply(cur.editing):cur.chosenMedia||e&&"post_field"==i||Wall.hideEditPost()}},deletePost:function(e,t){cur.wallMyDeleted[e]=1;var i=ge("post"+e);ajax.post("al_wall.php",{act:"delete",post:e,hash:t,from:"widget",app:cur.options.app},{onDone:function(t,o){var s=geByClass1("post_table",i)||geByClass1("reply_table",i),a=ge("post_del"+e);a?(a.innerHTML=t,show(a)):i.appendChild(ce("div",{id:"post_del"+e,className:"dld",innerHTML:t})),"posts"==cur.section&&cur.Rpc&&cur.Rpc.callMethod("publish","widgets.comments.delete_comment",o.count,o.last_comment,o.date,o.full_hash,o.pageId),hide(s)}});var o,s=ge("delete_post"+e);s&&s.tt&&s.tt.destroy&&s.tt.destroy(),(o=cur.wallMyReplies[e])&&((window.Emoji?Emoji.val:val)(ge("reply_field"+o.reply_to),o.message),o.reply_to_msg&&o.reply_to_user?Wall.replyTo(o.reply_to,o.reply_to_msg,o.reply_to_user):Wall.showEditReply(o.reply_to),(window.Emoji?Emoji.focus:elfocus)(ge("reply_field"+o.reply_to)))},markAsSpam:function(post,hash){if(!vk.id)return WComments.auth(),!1;ajax.post("al_wall.php",{act:"spam",post:post,hash:hash},{onDone:function(msg,js){var r=ge("post"+post),t=geByClass1("post_table",r)||geByClass1("reply_table",r),pd=ge("post_del"+post);pd?(pd.innerHTML=msg,show(pd)):r.appendChild(ce("div",{id:"post_del"+post,className:"dld",innerHTML:msg})),hide(t),js&&eval(js)}});var btn=ge("delete_post"+post);btn&&btn.tt&&btn.tt.el&&btn.tt.destroy()},restorePost:function(e,t){cur.wallMyDeleted[e]=0,ajax.post("al_wall.php",{act:"restore",post:e,hash:t,from:"widget"},{onDone:function(t){var i=ge("post_del"+e);if(i){var o=ge("post"+e),s=geByClass1("post_table",o)||geByClass1("reply_table",o);show(s),hide(i)}}})},checkPostClick:function(e,t){if(t=t||window.event,!e||!t)return!1;var i=t.target||t.srcElement,o=8,s=!1,a=/wall_post_text|post_media|event_share|public_share|group_share|feed_friends|feed_gifts|feed_videos|feed_explain_list|explain|feed_photos|feedback_row/;do if(!i||i==e||i.onclick||i.onmousedown||inArray(i.tagName,["A","IMG","TEXTAREA","EMBED","OBJECT"])||inArray(i.className,["play_new","page_video_inline_wrap"])||(s=i.className.match(a)))break;while(o--&&(i=i.parentNode));if(!s)return!0;var r=trim((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||document.selection&&document.selection.createRange().text||"").toString());return r?!0:!1},postClick:function(e,t){var i=(e||"").match(/^(-?\d+)_(wall)?(\d+)$/),o=ge("post"+e);if(i&&!Wall.checkPostClick(o,t)){var s=geByClass1("wall_post_more",o,"a");return s&&isVisible(s)?void s.onclick():void(hasClass(ge("wcomments_posts"),"no_post_click")||window.open("wall"+i[1]+"_"+i[3],"_blank"))}},checkReplyClick:function(e,t){if(t=t||window.event,!e||!t)return!1;var i=t.target||t.srcElement,o=8,s=!1;do if(!i||i==e||i.onclick||i.onmousedown||"A"==i.tagName&&"_reply_lnk"!=i.className||inArray(i.tagName,["IMG","TEXTAREA","EMBED","OBJECT"])||"wpe_cont"==i.id||(s=hasClass(i,"reply_table")))break;while(o--&&(i=i.parentNode));if(!s)return!0;var a=trim((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||document.selection&&document.selection.createRange().text||"").toString());

return a?!0:!1},replyClick:function(e,t,i,o){var s=intval(e),a=(e||"").match(/^(-?\d+)_(wall)?(\d+)$/),r=ge("post"+s+"_"+t);if(a&&((i||{}).cancelBubble=!0,!Wall.checkReplyClick(r,i))){var l=geByClass1("wall_reply_more",r,"a");return l&&isVisible(l)?(removeClass(r,"reply_moreable"),void l.onclick()):void(o&&Wall.replyTo(e,t,o,i))}},postOver:function(e){var t=ge("post"+e);t&&!hasClass(t,"one")&&(e.match(/^(-?\d+)_(wall)?(\d+)$/)&&addClass(t,"wall_post_over"),vk.id&&Wall.showDeletePost(e))},postOut:function(e){var t=ge("post"+e);t&&!hasClass(t,"one")&&(e.match(/^(-?\d+)_(wall)?(\d+)$/)&&removeClass(t,"wall_post_over"),vk.id&&t&&!hasClass(t,"one")&&Wall.hideDeletePost(e))},replyOver:function(e){if(vk.id){var t=e.split("_"),i=t.join(t[0].match(/(-?\d+)(photo|video|note|topic)/)?"_reply":"_wall_reply"),o=ge("like_link"+i),s=ge("like_icon"+i);return o?void(o.timeout?(clearTimeout(o.timeout),removeAttr(o,"timeout")):(fadeTo(o,200,1),Wall._animDelX(.3,void 0,e,"reply_delete"),Wall._animDelX(.3,void 0,e,"reply_edit"),hasClass(s,"no_likes")&&(setStyle(s,"visibility","visible"),animate(s,{opacity:.4},200)))):(Wall._animDelX(.3,void 0,e,"reply_delete"),void Wall._animDelX(.3,void 0,e,"reply_edit"))}},replyOut:function(e){if(vk.id){var t=e.split("_"),i=t.join(t[0].match(/(-?\d+)(photo|video|note|topic)/)?"_reply":"_wall_reply"),o=ge("like_link"+i),s=ge("like_icon"+i);return o?void(o.timeout=setTimeout(function(){removeAttr(o,"timeout"),fadeTo(o,200,0),Wall._animDelX(0,void 0,e,"reply_delete"),Wall._animDelX(0,void 0,e,"reply_edit"),hasClass(s,"no_likes")&&animate(s,{opacity:0},200,function(){hasClass(s,"no_likes")&&(s.style.visibility="hidden")})},1)):(Wall._animDelX(0,void 0,e,"reply_delete"),void Wall._animDelX(0,void 0,e,"reply_edit"))}},likeOver:function(e){var t=ge("like_icon"+e),i=ge("like_link"+e),o=ge("like_count"+e);if(t){hasClass(t,"my_like")||hasClass(t,"fw_my_like")?(t.style.visibility="visible",setStyle(t,{opacity:1})):setTimeout(animate.pbind(t,{opacity:1},200,!1),1);var s=e.match(/(-?\d+)(_?)(photo|video|note|topic|wall_reply|note_reply|photo_comment|video_comment|topic_comment|)(\d+)/);like_obj=(s[3]||"wall")+s[1]+"_"+s[4],linkW=i.clientWidth||i.offsetWidth,ttW=230,leftShift=ttW-(t.parentNode.clientWidth||t.parentNode.offsetWidth)+4,pointerShift=ttW-(o.clientWidth||o.offsetWidth)-14,showTooltip(t.parentNode,{url:"like.php",params:{act:"a_get_stats",object:like_obj,from:"wcomments"},slide:15,shift:[leftShift,5,9],ajaxdt:100,showdt:400,hidedt:200,tip:{over:function(){Wall.postOver(e),Wall.likeOver(e)},out:function(){Wall.likeOut(e),Wall.postOut(e)}},className:"rich like_tt",onShowStart:function(e){if(e.container){var t=geByClass1("bottom_pointer",e.container,"div"),i=geByClass1("top_pointer",e.container,"div");setStyle(t,{marginLeft:pointerShift}),setStyle(i,{marginLeft:pointerShift})}}})}},likeOut:function(e,t){var i=ge("like_icon"+e);i&&(hasClass(i,"my_like")||hasClass(i,"fw_my_like")||setTimeout(animate.pbind(ge("like_icon"+e),{opacity:.4},200,!1),1),t&&triggerEvent(i.parentNode,"mouseout"))},postLikeOver:function(e){var t=ge("like_icon"+e),i=ge("like_link"+e),o=ge("like_count"+e);if(t&&!cur.viewAsBox){var s=e.match(/(-?\d+)(_?)(photo|video|note|topic|wall_reply|note_reply|photo_comment|video_comment|topic_comment|)(\d+)/);like_obj=(s[3]||"wall")+s[1]+"_"+s[4],linkW=i.clientWidth||i.offsetWidth,ttW=230,leftShift=ttW-(t.parentNode.clientWidth||t.parentNode.offsetWidth)+7,pointerShift=ttW-(o.clientWidth||o.offsetWidth)-14,showTooltip(t.parentNode,{url:"like.php",params:{act:"a_get_stats",object:like_obj},slide:15,shift:[leftShift,7,7],ajaxdt:100,showdt:400,hidedt:200,tip:{over:function(){Wall.postOver(e),Wall.likeOver(e)},out:function(){Wall.likeOut(e),Wall.postOut(e)}},className:"rich like_tt",onShowStart:function(e){if(e.container&&pointerShift!==!1){var t=geByClass1("bottom_pointer",e.container,"div"),i=geByClass1("top_pointer",e.container,"div");setStyle(t,{marginLeft:pointerShift}),setStyle(i,{marginLeft:pointerShift})}}})}},postLikeOut:function(){},albumCoverOver:function(e,t,i){clearTimeout((cur.wallAlbumTO||{})[t]);var o=geByClass1("wall_album_caption",e),s=getSize(geByClass1("wall_album_description",e))[1];5>s||animate(o,{marginTop:Math.max(0,getSize(e)[1]-22-(s+7))},{duration:200,transition:Fx.Transitions.easeOutCirc})},albumCoverOut:function(e,t){cur.wallAlbumTO||(cur.wallAlbumTO={}),cur.wallAlbumTO[t]=setTimeout(function(){animate(geByClass1("wall_album_caption",e),{marginTop:getSize(e)[1]-22},200)},150)},likeUpdate:function(e,t,i,o){i=intval(i);var s=e.match(/(-?\d+)_(photo|video|note|topic|wall_reply|)(\d+)/),a=(s[2]||"wall")+s[1]+"_"+s[3],r=ge("like_real_count_"+a)||{},l=ge("like_table_"+a),n=ge("like_title_"+a),d=ge("like_count"+e),c=ge("like_icon"+e),p=d.parentNode.tt||{},h=clone(p.opts||{}),u=t?0:-31;if(o&&n&&val(n,o),r.value=i,animateCount(d,i),t)addClass(c,hasClass(c,"fw_like_icon")?"fw_my_like":"my_like");else{removeClass(c,hasClass(c,"fw_like_icon")?"fw_my_like":"my_like");var _=ge("like_share_wall"+e);_&&checkbox(_,!1)}if(i){var m=vk.rtl?"right":"left";if(!p.el||isVisible(p.container)||o){if(l){var v={};v[m]=u,animate(l,v,200)}}else l.style[m]=u+"px",p&&(p.likeInvalidated=!0),tooltips.show(p.el,extend(h,{showdt:0}));removeClass(c,"no_likes")}else p.el&&p.hide(),addClass(c,"no_likes")},like:function(e,t){if(vk.id&&!cur.viewAsBox){var i=hasClass(ge("like_icon"+e),"my_like"),o=e.match(/(-?\d+)_(photo|video|note|topic|wall_reply|)(\d+)/),s=(o[2]||"wall")+o[1]+"_"+o[3];ajax.post("like.php",{act:"a_do_"+(i?"un":"")+"like",object:s,hash:t,wall:1,from:"wcomments"},{onDone:Wall.likeUpdate.pbind(e)});var a=ge("like_real_count_wall"+e),r=a?a.value:ge("like_count"+e).innerHTML;Wall.likeUpdate(e,!i,intval(r)+(i?-1:1))}},likeShare:function(e,t){var i=ge("like_share_wall"+e),o=isChecked(i);checkbox(i),ajax.post("like.php",{act:"a_do_"+(o?"un":"")+"publish",object:"wall"+e,hash:t,wall:1,from:"wcomments"},{onDone:Wall.likeUpdate.pbind(e)});var s=ge("like_real_count_wall"+e),a=s?s.value:ge("like_count"+e).innerHTML,r=hasClass(ge("like_icon"+e),"my_like");Wall.likeUpdate(e,!0,intval(a)+(r?0:1))},showLikesPage:function(e,t,i){cur.likesBox.loadTabContent("like.php",{act:"a_get_members",object:"wall"+e,published:t,offset:i,wall:1},t)},showPhoto:function(e,t,i,o,s){return!showBox("al_photos.php",{act:"photo_box",to_id:e,photo:t,hash:i},{cache:1},o.href?s:!1)},_animDelX:function(e,t,i,o){void 0===i&&(i=t,t=void 0);var s=ge((o||"delete_post")+i);if(s){if(void 0!==t)s.active=t;else if(s.active)return;animate(s,{opacity:e},200)}},update:function(e){if("all"==cur.wallType||"own"==cur.wallType){var t={},i=ge("page_wall_switch"),o=ge("page_no_wall");each(["all","own"],function(){var e=ge("page_wall_count_"+this);t[this+""]=e&&intval(e.value)}),t.all&&o&&o.parentNode.removeChild(o),!t.own||t.own>=t.all?hide(i):(show(i),i.innerHTML=cur.options[cur.wallType+"_link"]),ge("page_wall_posts_count").innerHTML=t[cur.wallType]?langNumeric(t[cur.wallType],cur.options.wall_counts):"",ge("page_wall_header").href="/wall"+cur.oid+("own"==cur.wallType?"?own=1":"");var s=ge("wall_more_link"),e=geByClass(cur.wallType,ge("page_wall_posts")).length;e>=t[cur.wallType]?hide(s):(show(s),s.onclick=Wall.showMore.pbind(e))}},getAbsDate:function(e){var t,i=new Date(e||vkNow()),o=i.getHours(),s=i.getMinutes(),a="";return cur.wallTpl.time_system&&(a=cur.wallTpl.time_system[o>11?1:0],o=o%12||12),t=o>9?o:"0"+o,s=s>9?s:"0"+s,cur.wallTpl.date_format.replace("{am_pm}",a).replace("{hour}",o).replace("{num_hour}",t).replace("{minute}",s)},getNowRelTime:function(){var e=vkNow();return'<span class="rel_date rel_date_needs_update" time="'+intval(e/1e3-(cur.tsDiff||0))+'" abs_time="'+Wall.getAbsDate(e)+'">'+getLang("wall_just_now")+"</span>"},getNewPostHTML:function(e,t,i){var o=e[2],s=cur.wallTpl.post,a=rs(cur.wallTpl.post_actions,{actions:t||!e[2].indexOf(vk.id+"_")?cur.wallTpl.del:cur.wallTpl.spam}),r={name:e[3].replace("mem_link","author"),online:"",actions:a,photo:e[4],link:e[5],text:e[6],date:e[7],post_id:e[2],date_postfix:"",post_url:o.replace("_wall_reply","_")};return i&&extend(e,i(e)),each(r,function(e,t){s=s.replace(new RegExp("%"+e+"%","g"),t)}),s},getNewReplyHTML:function(e,t,i){var o=[],s=ge("reply_field"+e[2])||ge("reply_fakebox"+e[2])||ge("fwr_text"),a="";attr="",!t&&e[2].indexOf(vk.id+"_")&&e[4].indexOf(vk.id+"_")?e[2].split("_")[0]!=e[4]&&o.push(cur.wallTpl.spam_reply):o.push(cur.wallTpl.del_reply),-1!=e[8].indexOf('class="wall_reply_more"')&&(a+="reply_moreable"),s&&(cur.onepost?o.push(cur.wallTpl.answer_reply):a+=" reply_replieable",cur.options.reply_names[e[4]]||(cur.options.reply_names[e[4]]=[e[11],e[12]])),a&&(attr=" onclick=\"Wall.replyClick('%post_id%', %reply_msg_id%, event, %reply_uid%)\""),cur.onepost?(o.push(""),o=o.join('<span class="divide">|</span>')):o=rs(cur.wallTpl.post_actions,{actions:o.join("")});var r={name:e[5].replace("mem_link","author"),photo:psr(e[6]),online:"",link:e[7],text:psr(e[8]),media:"",classname:a,actions:o,attr:attr,date:Wall.getNowRelTime(),to_link:e[10],post_id:e[2],reply_id:e[3],like_id:e[3].replace("_","_wall_reply"),reply_msg_id:e[3].split("_")[1],reply_uid:e[4]||"false"};return i&&extend(r,i(r)),rs(cur.wallTpl.reply,r)},openNewComments:function(e){var t=ge("replies"+e),i=t.nextSibling,o=geByClass1("wr_header",t,"a"),s=0,a=geByClass("reply",t,"div").length,r=a,l=i.newCnt;each([].slice.call(geByClass("new_reply",t,"div")),function(){return removeClass(this,"new_reply"),this.style.backgroundColor="#FEFAE4",animate(this,{backgroundColor:"#FFF"},6e3),s++,100==s?!1:void 0}),o&&(r=s+intval(o.getAttribute("offs").split("/")[1])),a+=-l+s,(r>3||r>a)&&(o||t.insertBefore(o=ce("a",{className:"wr_header"}),t.firstChild),Wall.updateRepliesHeader(e,o,a,r)),cur.wallMyOpened[e]=1,i&&"replies_open"==i.className&&(l>100?(i.innerHTML=getLang("news_x_new_replies_more",Math.min(100,l-s)),i.newCnt-=s):re(i))},updateRepliesHeader:function(e,t,i,o){var s,a,r=t.href,l=3,n=0;if(!r&&(a=e.match(/^(-?\d+)_(photo|video|note|topic|video|)(\d+)$/))){var d=a[2]||"wall";switch(r="/"+d+a[1]+"_"+a[3],d){case"topic":r+="?offset=last&scroll=1";break;case"wall":r+="?offset=last&f=replies"}t.href=r}o>i?100>i?(o>100?(s=getLang("wall_show_n_of_m_last",100),s=s.replace("{count}",o)):s=getLang("wall_show_all_n_replies",o),l=!1):s=getLang("wall_hide_replies"):(s=getLang("wall_hide_replies"),n=1),toggleClass(t,"wrh_all",n),t.innerHTML='<div class="wrh_text" id="wrh_text'+e+'">'+s+'</div><div class="progress wrh_prg" id="wrh_prg'+e+'"></div>',t.onclick=Wall.showReplies.pbind(e,l,!1),t.setAttribute("offs",i+"/"+o)},checkRepliesLink:function(e,t){t=t||window.event;var i=e.id.match(/^replies_link(-?\d+)_(photo|video|note|topic|video|)(\d+)$/),o=e.href;if(!checkEvent(t))return e.parentNode.onclick(),cancelEvent(t);if(i){if(!o){var s=i[2]||"wall";switch(o="/"+s+i[1]+"_"+i[3],s){case"topic":o+="?offset=last&scroll=1";break;case"wall":o+="?offset=last&f=replies"}e.href=o}if("mousedown"!=t.type){if(browser.mozilla){var a=window.open(e.href,"_blank");try{a.blur(),window.focus()}catch(r){}return cancelEvent(t)}t.cancelBubble=!0}}},init:function(e){extend(cur,{postField:ge("post_field"),sendPostBtn:ge("send_post"),wallType:e.wall_type,withMentions:!(browser.mozilla&&browser.version.match(/^2\./)||browser.mobile),wallTpl:e.wall_tpl,wallMyDeleted:{},wallMyOpened:{},wallMyReplied:{},wallMyReplies:{},wallMyRepliesCnt:0}),e.wall_tpl&&e.wall_tpl.lang&&(cur.lang=extend(cur.lang||{},e.wall_tpl.lang)),Wall.update(),cur.sendPostBtn&&(cur.sendPostBtn.onclick=Wall.sendPost,placeholderSetup(cur.postField),each(geByTag("textarea",ge("page_wall_posts")),function(){placeholderSetup(this)}),removeEvent(document,"click",Wall.hideEditPostReply),addEvent(document,"click",Wall.hideEditPostReply),e.media_types&&ge("page_add_media")&&(cur.wallAddMedia=initAddMedia(ge("page_add_media").firstChild,"media_preview",e.media_types),cur.wallAddMedia.onChange=function(){Wall.checkPostLen(ge("post_field").value,!0)}))}},wall=extend(Wall,{showDeletePost:function(e){Wall._animDelX(.3,void 0,e,"post_delete"),Wall._animDelX(.3,void 0,e,"post_edit")},hideDeletePost:function(e){Wall._animDelX(0,void 0,e,"post_delete"),Wall._animDelX(0,void 0,e,"post_edit")},activeDeletePost:function(e,t,i){Wall._animDelX(1,1,e,i),t&&showTooltip(ge((i||"delete_post")+e),{text:t,showdt:0,black:1,shift:[14,3,3]})},deactiveDeletePost:Wall._animDelX.pbind(.3,0)}),urlActiveExp=/([!()?., \n\r\t \u00A0]|^)((https?:\/\/)?((?:[a-z0-9_\-]+\.)+[a-z]{2,6})(\/.*?)?)(&nbsp;|[ \t\r\n \u00A0])/i,urlInactiveExp=/([!()?., \n\r\t \u00A0]|^)((https?:\/\/)?((?:[a-z0-9_\-]+\.)+[a-z]{2,6})(\/.*?)?)(&nbsp;|[ \t\r\n \u00A0]|$)/i;try{stManager.done("api/widgets/al_comments.js")}catch(e){}Scrollbar.prototype.contOver=function(){this.isOut=!1,this.shown&&addClass(this.scrollbar,"scrollbar_c_overed")},Scrollbar.prototype.contOut=function(){this.isOut=!0,this.isDown||removeClass(this.scrollbar,"scrollbar_c_overed")},Scrollbar.prototype.contDown=function(e){var t,i;this.isHorizontal?(t=e.offsetX-this.innerWidth/2+5,scrH=this.scrollWidth-this.innerWidth,i=Math.floor((this.contWidth()-this.scrollWidth)*Math.min(1,t/scrH)),this.obj.scrollLeft=i):(t=e.offsetY-this.innerHeight/2+5,scrH=this.scrollHeight-this.innerHeight,i=Math.floor((this.contHeight()-this.scrollHeight)*Math.min(1,t/scrH)),this.obj.scrollTop=i),this.update(!0),this.mouseDown(e)},Scrollbar.prototype._mouseMove=function(e){var t;return this.isHorizontal?(t=Math.floor((this.contWidth()-this.scrollWidth)*Math.min(1,(e.pageX-this.moveX)/(this.scrollWidth-this.innerWidth-6))),this.options.onScroll&&this.options.onScroll(this.obj.scrollLeft-t),this.obj.scrollLeft=t):(t=Math.floor((this.contHeight()-this.scrollHeight)*Math.min(1,(e.pageY-this.moveY)/(this.scrollHeight-this.innerHeight-6))),this.options.onScroll&&this.options.onScroll(this.obj.scrollTop-t),this.obj.scrollTop=t),this.update(!0),!1},Scrollbar.prototype._mouseUp=function(e){return this.moveY=!1,this.moveX=!1,this.isDown=!1,this.isOut&&this.contOut(),removeEvent(window.document,"mousemove",this.mouseMove),removeEvent(window.document,"mouseup",this.mouseUp),window.document.body.style.cursor="default",removeClass(this.inner,this.clPref+"scrollbar_hovered"),this.options.stopDrag&&this.options.stopDrag(),this.options.onHold&&this.options.onHold(!1),!1},Scrollbar.prototype.wheel=function(e){if(!this.disabled){e||(e=window.event);var t,i=0;return e.wheelDeltaY||e.wheelDelta?i=(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&(i=10*-e.detail),t=this.obj[this.scrollProp],this.obj[this.scrollProp]-=i,this.options.onScroll&&this.options.onScroll(i),t!=this.obj[this.scrollProp]&&this.shown!==!1&&(this.update(!0),addClass(this.inner,this.clPref+"scrollbar_hovered"),clearTimeout(this.moveTimeout),this.moveTimeout=setTimeout(function(){removeClass(this.inner,this.clPref+"scrollbar_hovered")}.bind(this),300)),!this.shown&&!this.options.forceCancelEvent||this.isHorizontal&&t==this.obj[this.scrollProp]?void 0:!1}},Scrollbar.prototype.hide=function(e){hide(this.topShadowDiv,this.bottomShadowDiv,this.scrollbar),this.hidden=!0},Scrollbar.prototype.show=function(e){show(this.topShadowDiv,this.bottomShadowDiv,this.scrollbar),this.hidden=!1},Scrollbar.prototype.disable=function(){this.hide(),this[this.scrollProp](0),this.disabled=!0},Scrollbar.prototype.enable=function(){this.show(),this.update(),this.disabled=!1},Scrollbar.prototype.scrollTop=function(e){this.obj.scrollTop=parseInt(e),this.update(!1,!0)},Scrollbar.prototype.scrollLeft=function(e){this.obj.scrollLeft=parseInt(e),this.update(!1,!0)},Scrollbar.prototype.destroy=function(e){each(this.destroyList,function(e,t){t()})},Scrollbar.prototype.contHeight=function(){if(this.options.contHeight)return this.options.contHeight;if(this.contHashCash)return this.contHashCash;for(var e=this.obj.childNodes,t=0,i=e.length;i--;)t+=e[i].offsetHeight||0;return this.contHashCash=t,t},Scrollbar.prototype.contWidth=function(){if(this.options.contWidth)return this.options.contWidth;if(this.contHashWidthCash)return this.contHashWidthCash;for(var e=this.obj.childNodes,t=0,i=e.length;i--;)t+=e[i].offsetWidth||0;return this.contHashWidthCash=t,t},Scrollbar.prototype.val=function(e){return e&&(this.obj[this.scrollProp]=e,this.update(!0,!0)),this.obj[this.scrollProp]},Scrollbar.prototype.update=function(e,t){if(this.inited&&!this.hidden){if(!e){if(this.contHashCash=!1,this.contHashWidthCash=!1,this.moveY&&!this.isHorizontal)return!0;if(this.moveX)return!0}if(t){var i=getSize(this.obj);this.isHorizontal?(this.scrollWidth=i[0],setStyle(this.scrollbar,"width",i[0])):(this.scrollHeight=i[1],setStyle(this.scrollbar,"height",i[1]))}var o=this.contHeight(),s=this.contWidth();if(!this.isHorizontal&&o<=this.scrollHeight)return hide(this.inner,this.bottomShadowDiv,this.topShadowDiv),setStyle(this.scrollbar,{pointerEvents:"none"}),this.topShadow=this.bottomShadow=!1,void(this.shown=!1);if(this.isHorizontal&&s<=this.scrollWidth)return hide(this.inner,this.bottomShadowDiv,this.topShadowDiv),setStyle(this.scrollbar,{pointerEvents:"none"}),this.topShadow=this.bottomShadow=!1,void(this.shown=!1);this.shown||(show(this.inner),setStyle(this.scrollbar,{pointerEvents:"auto"}),this.shown=!0);var a;if(this.isHorizontal){var r=this.val();this.options.scrollChange&&this.options.scrollChange(r),a=this.lastProgress=Math.min(1,r/(s-this.scrollWidth))}else{var l=this.val();this.options.scrollChange&&this.options.scrollChange(l),a=this.lastProgress=Math.min(1,l/(o-this.scrollHeight))}a>0!=(this.topShadow?!0:!1)&&((this.topShadow?hide:show)(this.topShadowDiv),this.topShadow=!this.topShadow),1>a!=(this.bottomShadow?!0:!1)&&((this.bottomShadow?hide:show)(this.bottomShadowDiv),this.bottomShadow=!this.bottomShadow),this.isHorizontal?(this.innerWidth=Math.max(40,Math.floor(this.scrollWidth*this.scrollWidth/s)),this.inner.style.width=this.innerWidth+"px",this.inner.style.marginLeft=Math.floor((this.scrollWidth-this.innerWidth-4)*a+2)+"px"):(this.innerHeight=Math.max(40,Math.floor(this.scrollHeight*this.scrollHeight/o)),this.inner.style.height=this.innerHeight+"px",this.inner.style.marginTop=Math.floor((this.scrollHeight-this.innerHeight-4)*a+2)+"px"),this.options.more&&isFunction(this.options.more)&&(this.options.contHeight||o-this.obj[this.scrollProp]<2*this[this.scrollDimensionProp])&&this.options.more()}},window._videoLastInlined=!1;var oldShowBox=showBox;